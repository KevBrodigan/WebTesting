!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SwrveSDK=t():e.SwrveSDK=t()}(self,(()=>{return e={376:function(e){var t;t=()=>(()=>{var e={698:()=>{"use strict";!function(){if(void 0===window.Reflect||void 0===window.customElements||window.customElements.polyfillWrapFlushCallback)return;const e=HTMLElement;window.HTMLElement=function(){return Reflect.construct(e,[],this.constructor)},HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}()},249:function(e,t,n){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(480)}catch(e){}var i=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),o={},a=o.lib={},u=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),l=o.enc={},p=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},h=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},g=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},f=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=g.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,l=e.min(4*u,s);if(u){for(var p=0;p<u;p+=o)this._doProcessBlock(i,p);n=i.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(a.Hasher=f.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),o.algo={});return o}(Math),r)},214:function(e,t,n){var r;e.exports=(r=n(249),function(e){var t=r,n=t.lib,i=n.WordArray,s=n.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var u=o.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,o=e[t+0],u=e[t+1],g=e[t+2],f=e[t+3],d=e[t+4],_=e[t+5],v=e[t+6],m=e[t+7],y=e[t+8],E=e[t+9],S=e[t+10],b=e[t+11],w=e[t+12],I=e[t+13],C=e[t+14],A=e[t+15],M=s[0],T=s[1],N=s[2],D=s[3];M=c(M,T,N,D,o,7,a[0]),D=c(D,M,T,N,u,12,a[1]),N=c(N,D,M,T,g,17,a[2]),T=c(T,N,D,M,f,22,a[3]),M=c(M,T,N,D,d,7,a[4]),D=c(D,M,T,N,_,12,a[5]),N=c(N,D,M,T,v,17,a[6]),T=c(T,N,D,M,m,22,a[7]),M=c(M,T,N,D,y,7,a[8]),D=c(D,M,T,N,E,12,a[9]),N=c(N,D,M,T,S,17,a[10]),T=c(T,N,D,M,b,22,a[11]),M=c(M,T,N,D,w,7,a[12]),D=c(D,M,T,N,I,12,a[13]),N=c(N,D,M,T,C,17,a[14]),M=l(M,T=c(T,N,D,M,A,22,a[15]),N,D,u,5,a[16]),D=l(D,M,T,N,v,9,a[17]),N=l(N,D,M,T,b,14,a[18]),T=l(T,N,D,M,o,20,a[19]),M=l(M,T,N,D,_,5,a[20]),D=l(D,M,T,N,S,9,a[21]),N=l(N,D,M,T,A,14,a[22]),T=l(T,N,D,M,d,20,a[23]),M=l(M,T,N,D,E,5,a[24]),D=l(D,M,T,N,C,9,a[25]),N=l(N,D,M,T,f,14,a[26]),T=l(T,N,D,M,y,20,a[27]),M=l(M,T,N,D,I,5,a[28]),D=l(D,M,T,N,g,9,a[29]),N=l(N,D,M,T,m,14,a[30]),M=p(M,T=l(T,N,D,M,w,20,a[31]),N,D,_,4,a[32]),D=p(D,M,T,N,y,11,a[33]),N=p(N,D,M,T,b,16,a[34]),T=p(T,N,D,M,C,23,a[35]),M=p(M,T,N,D,u,4,a[36]),D=p(D,M,T,N,d,11,a[37]),N=p(N,D,M,T,m,16,a[38]),T=p(T,N,D,M,S,23,a[39]),M=p(M,T,N,D,I,4,a[40]),D=p(D,M,T,N,o,11,a[41]),N=p(N,D,M,T,f,16,a[42]),T=p(T,N,D,M,v,23,a[43]),M=p(M,T,N,D,E,4,a[44]),D=p(D,M,T,N,w,11,a[45]),N=p(N,D,M,T,A,16,a[46]),M=h(M,T=p(T,N,D,M,g,23,a[47]),N,D,o,6,a[48]),D=h(D,M,T,N,m,10,a[49]),N=h(N,D,M,T,C,15,a[50]),T=h(T,N,D,M,_,21,a[51]),M=h(M,T,N,D,w,6,a[52]),D=h(D,M,T,N,f,10,a[53]),N=h(N,D,M,T,S,15,a[54]),T=h(T,N,D,M,u,21,a[55]),M=h(M,T,N,D,y,6,a[56]),D=h(D,M,T,N,A,10,a[57]),N=h(N,D,M,T,v,15,a[58]),T=h(T,N,D,M,I,21,a[59]),M=h(M,T,N,D,d,6,a[60]),D=h(D,M,T,N,b,10,a[61]),N=h(N,D,M,T,g,15,a[62]),T=h(T,N,D,M,E,21,a[63]),s[0]=s[0]+M|0,s[1]=s[1]+T|0,s[2]=s[2]+N|0,s[3]=s[3]+D|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296),o=r;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,u=a.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,n,r,i,s,o){var a=e+(t&n|~t&r)+i+o;return(a<<s|a>>>32-s)+t}function l(e,t,n,r,i,s,o){var a=e+(t&r|n&~r)+i+o;return(a<<s|a>>>32-s)+t}function p(e,t,n,r,i,s,o){var a=e+(t^n^r)+i+o;return(a<<s|a>>>32-s)+t}function h(e,t,n,r,i,s,o){var a=e+(n^(t|~r))+i+o;return(a<<s|a>>>32-s)+t}t.MD5=s._createHelper(u),t.HmacMD5=s._createHmacHelper(u)}(Math),r.MD5)},449:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AssetManager=void 0;var i=r(n(560)),s=r(n(936)),o=function(){function e(){this.assets={},this._imagesCDN="",this._fontsCDN=""}return e.prototype.manageAssets=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.getAssetID();void 0===this.assets[i]&&(s.default.info("ASSET MANAGER: add new asset "+i),this.assets[i]={id:i,path:r.getAssetPath().toString()})}return this.downloadAssets()},Object.defineProperty(e.prototype,"ImagesCDN",{get:function(){return this._imagesCDN},set:function(e){this._imagesCDN=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"FontsCDN",{get:function(){return this._fontsCDN},set:function(e){this._fontsCDN=e},enumerable:!1,configurable:!0}),e.prototype.clearCDN=function(){this._imagesCDN="",this._fontsCDN=""},e.prototype.checkAssetsForCampaign=function(e){for(var t=!0,n=0,r=e;n<r.length;n++){var i=r[n];if(!this.checkCache(i)){t=!1;break}}return t},e.prototype.checkCache=function(e){return i.default.getPlatform().checkStorageForAsset(e)},e.prototype.downloadAssets=function(){var e=this;s.default.info("Asset Manager download assets");var t=Object.keys(this.assets).map((function(t){return e.assets[t]}));return i.default.getPlatform().downloadAssets(t)},e}();t.AssetManager=o},607:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignManager=void 0;var s=n(860),o=n(594),a=n(449),u=i(n(936)),c=n(12),l=n(403),p=i(n(756)),h=function(){function e(e,t,n,r){this.profileManager=e,this.campaigns=[],this.campaignState={},this.messages=[],this.triggers=[],this.onEmbeddedListener=null,this._maxMessagesPerSession=99999,this._minDelay=55,this._delayFirstMessage=150,this.MAX_MESSAGES_PER_SESSION=99999,this.MIN_DELAY=55,this.DELAY_FIRST_MESSAGE=150,this.messagesShownCount=0,this.lastShownMessageTime=0,this.storageManager=n,this.loadStoredCampaigns(this.profileManager.currentUser.userId),this.messageDisplayManager=new o.SwrveMessageDisplayManager(t,r),this.assetManager=new a.AssetManager,this.platform=t}return e.prototype.storeCampaigns=function(e,t,n){void 0!==e&&e.campaigns&&(this.handleCDN(e),this.campaigns=e.campaigns.campaigns||[],this.parseGlobalRules(e.campaigns),this.parseMessages(this.campaigns),this.parseTriggers(this.campaigns),this.synchronizeCampaignState(),this.handleAssets(n,t),this.storageManager.saveData(s.CAMPAIGNS+this.profileManager.currentUser.userId,JSON.stringify(this.campaigns)))},e.prototype.resetCampaignState=function(){this.campaigns=[],this.messages=[],this.triggers=[],this.campaignState={},this.messagesShownCount=0,this.lastShownMessageTime=0},e.prototype.loadStoredCampaigns=function(e){this.resetCampaignState();var t=this.storageManager.getData(s.CAMPAIGNS+e);t&&(this.campaigns=JSON.parse(t));var n=this.storageManager.getData(s.CAMPAIGN_STATE+e);n&&(this.campaignState=JSON.parse(n)),this.campaigns&&(this.parseMessages(this.campaigns),this.parseTriggers(this.campaigns))},e.prototype.synchronizeCampaignState=function(){var e=this,t=this.campaignState;this.campaignState={},this.campaigns.forEach((function(n){var r=n.id;e.campaignState[r]=t[r]||{status:s.SWRVE_CAMPAIGN_STATUS_UNSEEN,impressions:0,next:0,lastShownTime:0}})),this.storageManager.saveData(s.CAMPAIGN_STATE+this.profileManager.currentUser.userId,JSON.stringify(this.campaignState))},e.prototype.getCampaignIDs=function(){var e=this;return this.campaigns.map((function(t){return{id:t.id,type:t.messages?"iam":"unknown",variant_id:e.getCampaignVariantID(t)}}))},e.prototype.getCampaignVariantID=function(e){return e.messages&&e.messages[0]?e.messages[0].id:0},e.prototype.getCampaignState=function(e){return this.campaignState[e]},e.prototype.onEmbeddedMessage=function(e){this.onEmbeddedListener=e},e.prototype.onButtonClicked=function(e){this.messageDisplayManager.onButtonClicked(e)},e.prototype.showCampaign=function(e,t,n){if(e.messages&&e.messages.length>0){var r=e.messages[0];return r.parentCampaign=e.id,this.canCampaignRender(e,t)?(this.messageDisplayManager.showMessage(e.messages[0],e,this.assetManager.ImagesCDN,t),n&&n(r),this.updateCampaignState(r),!0):(u.default.error("Cannot render campaign, not attempting to display"),!1)}return!(!e.embedded_message||!e.embedded_message.data||(e.embedded_message.parentCampaign=e.id,this.onEmbeddedListener&&this.onEmbeddedListener(e.embedded_message,t),0))},e.prototype.checkTriggers=function(e,t,n,i,o){var a=this;void 0===i&&(i=!1);var c,l=[],p=this.applyGlobalRules(),h=[];function g(e,t,n,r){u.default.debug("Campaign trigger status: "+n+" Displayed "+t),c={status:r,message:n},h.push({id:e,displayed:t,type:"iam",reason:n})}if(p.status===s.CAMPAIGN_MATCH)if(this.campaigns.forEach((function(n){if(n.triggers&&n.triggers.length>0)for(var o=0,u=n.triggers;o<u.length;o++){var c=u[o],p=c.event_name===e&&a.canTriggerWithPayload(c,t);if(!p&&i){var h="Campaign ["+n.id+"], Trigger ["+c.event_name+"], does not match eventName["+e+"] & payload["+JSON.stringify(t)+"].  Skipping this trigger.";g(n.id,"false",h,s.CAMPAIGN_NO_MATCH)}if(p){n.messages?n.messages.forEach((function(e){return l.push(r({parentCampaign:n.id},e))})):n.embedded_message&&l.push(r({parentCampaign:n.id},n.embedded_message));break}}else i&&(h="Campaign ["+n.id+"], no triggers (could be message centre). Skipping this campaign",g(n.id,"false",h,s.CAMPAIGN_ERROR_INVALID_TRIGGERS))})),l.length>0){l.sort((function(e,t){return e.priority-t.priority}));var f=l.filter((function(e){for(var t=0,n=a.campaigns;t<n.length;t++){var r=n[t];if(r.id===e.parentCampaign){var c=a.applyCampaignRules(r,o),l=c.status,p=c.message,h=l===s.CAMPAIGN_MATCH;return u.default.debug(p),i&&!h&&g(r.id,"false",p,l),h}}return!1}));if(f.length>1){var d=f.reduce((function(e,t){return t.priority<e?t.priority:e}),f[0].priority);f=f.filter((function(e){return e.priority<=d}))}if(f.length>0){var _=f.length>1?Math.floor(Math.random()*f.length):0,v=f[_];if(i){var m=f[_];f.filter((function(e,t){return t!==_})).forEach((function(e){var t="Campaign "+m.id+" was selected for display ahead of this campaign.";g(e.parentCampaign,"false",t,s.CAMPAIGN_ELIGIBLE_BUT_OTHER_CHOSEN)}));var y="Campaign ["+m.id+"], Trigger ["+e+"], matches "+e+" & payload "+JSON.stringify(t)+".";g(m.parentCampaign,"true",y,s.CAMPAIGN_MATCH)}if(this.lastShownMessageTime=this.getNow(),!this.messageDisplayManager.isIAMShowing())for(var E=0,S=this.campaigns;E<S.length;E++){var b=S[E];if(b.id===v.parentCampaign){if(b.messages&&b.messages.length>0){this.showMessage(v,b,o),this.updateCampaignState(v),n(v);break}if(b.embedded_message&&b.embedded_message.data){this.onEmbeddedListener&&this.onEmbeddedListener(v,o);break}}}}}else i&&(p={status:s.CAMPAIGN_NO_MATCH,message:"No matching campaigns."});var w=p.status===s.CAMPAIGN_MATCH&&c?c.status:p.status;return{globalStatus:p,campaignStatus:c,campaignFailCode:w,campaigns:h}},e.prototype.showMessage=function(e,t,n){this.messageDisplayManager.showMessage(e,t,this.assetManager.ImagesCDN,n)},e.prototype.closeMessage=function(){this.messageDisplayManager.closeMessage()},e.prototype.canTriggerWithPayload=function(e,t){return!("object"!=typeof e||!e)&&this.hasFulfilledCondition(e.conditions||{},t||{})},e.prototype.hasFulfilledCondition=function(e,t){switch(e.op){case"eq":return t[e.key]===e.value;case"and":for(var n=0,r=e.args;n<r.length;n++){var i=r[n];if(!this.hasFulfilledCondition(i,t))return!1}return!0;default:return 0===Object.keys(e).length}},e.prototype.handleCDN=function(e){if(this.assetManager.clearCDN(),e.campaigns&&e.campaigns.cdn_root)this.assetManager.ImagesCDN=e.campaigns.cdn_root;else if(e.campaigns&&e.campaigns.cdn_paths){var t=e.campaigns.cdn_paths;this.assetManager.ImagesCDN=t.message_images,this.assetManager.FontsCDN=t.message_fonts}},e.prototype.getAssetManager=function(){return this.assetManager},e.prototype.getMessageCenterCampaigns=function(e){var t=this;return this.campaigns.filter((function(n){return n.message_center&&t.campaignState[n.id].status!==s.SWRVE_CAMPAIGN_STATUS_DELETED&&t.canCampaignRender(n,e)})).map((function(e){return r({},e)}))},e.prototype.updateCampaignState=function(e){for(var t=0,n=this.campaigns;t<n.length;t++){var r=n[t];if(r.id===e.parentCampaign){var i=this.campaignState[r.id];i.impressions++,i.status=s.SWRVE_CAMPAIGN_STATUS_SEEN,i.lastShownTime=this.getNow(),this.campaignState[r.id]=i,this.storageManager.saveData(s.CAMPAIGN_STATE+this.profileManager.currentUser.userId,JSON.stringify(this.campaignState)),this.messagesShownCount++;break}}},e.prototype.markCampaignAsSeen=function(e){this.setCampaignStatus(e,s.SWRVE_CAMPAIGN_STATUS_SEEN)},e.prototype.removeMessageCenterCampaign=function(e){this.setCampaignStatus(e,s.SWRVE_CAMPAIGN_STATUS_DELETED)},e.prototype.setCampaignStatus=function(e,t){if(e){var n=this.campaignState[e.id];n.status=t,this.campaignState[e.id]=n,this.storageManager.saveData(s.CAMPAIGN_STATE+this.profileManager.currentUser.userId,JSON.stringify(this.campaignState))}},e.prototype.applyGlobalRules=function(){if(this.messagesShownCount>=this._maxMessagesPerSession)return{status:s.GLOBAL_CAMPAIGN_THROTTLE_MAX_IMPRESSIONS,message:"{App Throttle limit} Too many messages shown."};var e=this.profileManager.currentUser.sessionStart+1e3*this._delayFirstMessage;if(u.default.info("delay first message "+this._delayFirstMessage),e>this.getNow())return{status:s.GLOBAL_CAMPAIGN_THROTTLE_LAUNCH_TIME,message:"{App Throttle limit} Too soon after launch.  Wait until "+e};var t=this.lastShownMessageTime+1e3*this._minDelay;return 0!==this.lastShownMessageTime&&t>this.getNow()?{status:s.GLOBAL_CAMPAIGN_THROTTLE_RECENT,message:"{App Throttle limit} Too soon after last message.  Wait until "+t}:{status:s.CAMPAIGN_MATCH,message:"Global display rules passing."}},e.prototype.applyCampaignRules=function(t,n){var r=t.rules,i=this.campaignState[t.id];if(t.start_date>this.getNow()||t.end_date<this.getNow())return{status:s.CAMPAIGN_NOT_ACTIVE,message:"Campaign "+t.id+"not active."};var o=this.profileManager.currentUser.sessionStart+1e3*r.delay_first_message;if(o>this.getNow())return{status:s.CAMPAIGN_THROTTLE_LAUNCH_TIME,message:"{Campaign throttle limit} Too soon after launch. Wait until "+o};if(r.hasOwnProperty("dismiss_after_views")&&i.impressions>=r.dismiss_after_views){var a="{Campaign throttle limit} Campaign "+t.id+" has been shown "+t.rules.dismiss_after_views+" times already";return{status:s.CAMPAIGN_THROTTLE_MAX_IMPRESSIONS,message:a}}var u=i.lastShownTime+1e3*r.min_delay_between_messages;if(0!==i.lastShownTime&&u>this.getNow())return a="{Campaign throttle limit} Too soon after last campaign. Wait until "+(u+r.min_delay_between_messages),{status:s.CAMPAIGN_THROTTLE_RECENT,message:a};var c=e.getAllAssets([t],this.assetManager.ImagesCDN,n);return c.every((function(e){return e.canRender()}))?this.assetManager.checkAssetsForCampaign(c)?{status:s.CAMPAIGN_MATCH,message:"Campaign "+t.id+"passes display rules"}:{status:s.CAMPAIGN_NOT_DOWNLOADED,message:"Assets not loaded for Campaign "+t}:{status:s.CAMPAIGN_COULD_NOT_PERSONALIZE,message:"Personalization failed for campaign "+t}},e.prototype.parseGlobalRules=function(e){if(e&&e.rules){var t=e.rules;this._maxMessagesPerSession=t.hasOwnProperty("max_messages_per_session")?t.max_messages_per_session:this.MAX_MESSAGES_PER_SESSION,this._minDelay=t.hasOwnProperty("min_delay_between_messages")?t.min_delay_between_messages:this.MIN_DELAY,this._delayFirstMessage=t.hasOwnProperty("delay_first_message")?t.delay_first_message:this.DELAY_FIRST_MESSAGE}u.default.info("Global Rules: max_messages_per_session:"+this._maxMessagesPerSession+" min_delay:"+this._minDelay+" delay_first_message:"+this._delayFirstMessage)},e.prototype.parseMessages=function(e){var t=this;e.forEach((function(e){e.messages&&e.messages.forEach((function(n){return t.messages.push(r({parentCampaign:e.id},n))})),e.embedded_message&&t.messages.push(r({parentCampaign:e.id},e.embedded_message))}))},e.prototype.parseTriggers=function(e){var t=this;e.forEach((function(e){e.triggers&&e.triggers.forEach((function(n){return t.triggers.push(r({parentCampaign:e.id},n))}))}))},e.prototype.handleAssets=function(t,n){var r=e.getAllAssets(this.campaigns,this.assetManager.ImagesCDN,n);this.assetManager.manageAssets(r).then((function(){u.default.info("CampaignManager: asset download complete"),t()})).catch((function(e){u.default.info("Error downloading assets "+e)}))},e.getAllAssets=function(e,t,n){for(var r=[],i=0,s=e;i<s.length;i++)for(var o=0,a=s[i].messages||[];o<a.length;o++)for(var u=a[o],p=0,h=u.template&&u.template.formats||[];p<h.length;p++){for(var g=h[p],f=0,d=g.buttons||[];f<d.length;f++){var _=d[f];r.push(new c.SwrveButton(_,t,n))}for(var v=0,m=g.images||[];v<m.length;v++){var y=m[v];r.push(new l.SwrveImage(y,t,n))}}return r},e.prototype.canCampaignRender=function(t,n){return e.getAllAssets([t],this.assetManager.ImagesCDN,n).every((function(e){return e.canRender()}))},e.prototype.getNow=function(){return p.default.nowInUtcTime()},e}();t.CampaignManager=h},297:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(151),o=n(79),a=n(431),u=function(e){function t(){var n=e.call(this)||this;return n._root=n.attachShadow({mode:"closed"}),n._root.appendChild(document.importNode(t.template().content,!0)),n._$styles=n._root.querySelector("style"),n._$button=n._root.querySelector("button"),n}return i(t,e),Object.defineProperty(t.prototype,"button",{set:function(e){this._button=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"personalizationProperties",{set:function(e){this._personalizationProperties=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasWidth",{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textForegroundColor",{get:function(){var e=o.DEFAULT_IAM_TEXT_FOREGROUND_COLOR;return this._inAppConfig&&this._inAppConfig.defaultTextForegroundColor&&(e=this._inAppConfig.defaultTextForegroundColor),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBackgroundColor",{get:function(){var e=o.DEFAULT_IAM_TEXT_BACKGROUND_COLOR;return this._inAppConfig&&this._inAppConfig.defaultTextBackgroundColor&&(e=this._inAppConfig.defaultTextBackgroundColor),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textFontStyle",{get:function(){var e=o.DEFAULT_IAM_TEXT_FONT;return this._inAppConfig&&this._inAppConfig.defaultTextFontStyle&&(e=this._inAppConfig.defaultTextFontStyle),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasHeight",{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inAppConfig",{set:function(e){this._inAppConfig=e},enumerable:!1,configurable:!0}),t.prototype.connectedCallback=function(){this._button.isSingleLineText?this.appendTextButton():this.appendImageButton()},t.prototype.appendTextButton=function(){var e=this.resolvePersonalizedText(this._button.button.text.value);this._$button.ariaLabel=e,this._$button.textContent=e,this._$styles.textContent+="\n      button {\n        background-color: #FFFFFF;\n        width: ".concat(this._button.getWidth(),"px;\n        height: ").concat(this._button.getHeight(),"px;\n        top: ").concat(this.absoluteTopPosition(),"px;\n        left: ").concat(this.absoluteLeftPosition(),"px;\n        font-size: ").concat((0,a.getSingleLineTextFittedFontSize)(this._button.getWidth(),this._button.getHeight(),e,this.textFontStyle),"px;\n        background-color: ").concat(this.textBackgroundColor,";\n        color: ").concat(this.textForegroundColor,";\n        font-family: ").concat(this.textFontStyle,";\n      }\n    ")},t.prototype.appendImageButton=function(){this._$styles.textContent+="\n      button {\n        background-image: url(".concat(this._button.getAssetPath(),");\n        background-size: cover;\n        width: ").concat(this._button.getWidth(),"px;\n        height: ").concat(this._button.getHeight(),"px;\n        top: ").concat(this.absoluteTopPosition(),"px;\n        left: ").concat(this.absoluteLeftPosition(),"px;\n      }\n    ")},t.prototype.absoluteTopPosition=function(){return this._button.button.y.value+(this.canvasHeight/2-this._button.getHeight()/2)},t.prototype.absoluteLeftPosition=function(){return this._button.button.x.value+(this.canvasWidth/2-this._button.getWidth()/2)},t.prototype.resolvePersonalizedText=function(e){return s.TextTemplating.applyTextTemplatingToString(e,this._personalizationProperties)||e},t.template=function(){var e=document.createElement("template");return e.innerHTML=o.SWRVE_IAM_BUTTON_TEMPLATE_LITERAL,e},t}(HTMLElement);t.default=u},638:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(151),a=n(431),u=s(n(936)),c=n(79),l=function(e){function t(){var t=e.call(this)||this;return t._root=t.attachShadow({mode:"closed"}),t}return i(t,e),Object.defineProperty(t.prototype,"image",{set:function(e){this._image=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasWidth",{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasHeight",{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textForegroundColor",{get:function(){var e=c.DEFAULT_IAM_TEXT_FOREGROUND_COLOR;return this._inAppConfig&&this._inAppConfig.defaultTextForegroundColor&&(e=this._inAppConfig.defaultTextForegroundColor),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBackgroundColor",{get:function(){var e=c.DEFAULT_IAM_TEXT_BACKGROUND_COLOR;return this._inAppConfig&&this._inAppConfig.defaultTextBackgroundColor&&(e=this._inAppConfig.defaultTextBackgroundColor),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textFontStyle",{get:function(){var e=c.DEFAULT_IAM_TEXT_FONT;return this._inAppConfig&&this._inAppConfig.defaultTextFontStyle&&(e=this._inAppConfig.defaultTextFontStyle),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"personalizationProperties",{set:function(e){this._personalizationProperties=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inAppConfig",{set:function(e){this._inAppConfig=e},enumerable:!1,configurable:!0}),t.prototype.connectedCallback=function(){this._image.isSingleLineText?this.appendText():this.appendImage()},t.prototype.appendImage=function(){var e=document.createElement("style"),t=document.createElement("img");e.textContent+="\n      img {\n        width: ".concat(this._image.getWidth(),"px;\n        height: ").concat(this._image.getHeight(),"px;\n        top: ").concat(this.absoluteTopPosition(),"px;\n        left: ").concat(this.absoluteLeftPosition(),"px;\n      }\n    "),t.src=this._image.getAssetPath(),this._root.appendChild(e),this._root.appendChild(t)},t.prototype.appendText=function(){var e=this.resolvePersonalizedText(this._image.image.text.value);if(null!==e){var t=document.createElement("style"),n=document.createElement("div");n.className="text",t.textContent+="\n      .text {\n        width: ".concat(this._image.getWidth(),"px;\n        height: ").concat(this._image.getHeight(),"px;\n        top: ").concat(this.absoluteTopPosition(),"px;\n        left: ").concat(this.absoluteLeftPosition(),"px;\n        font-size: ").concat((0,a.getSingleLineTextFittedFontSize)(this._image.getWidth(),this._image.getHeight(),e,this.textFontStyle),"px;\n        background-color: ").concat(this.textBackgroundColor,";\n        color: ").concat(this.textForegroundColor,";\n        font-family: ").concat(this.textFontStyle,";\n        position: absolute;\n        overflow: hidden; \n        white-space: nowrap; \n        display: flex; \n        justify-content: center; \n        align-items: center;\n        padding: 0;\n        border: none;\n      }\n    "),n.innerText=e,this._root.appendChild(t),this._root.appendChild(n)}},t.prototype.absoluteTopPosition=function(){return this._image.image.y.value+(this.canvasHeight/2-this._image.getHeight()/2)},t.prototype.absoluteLeftPosition=function(){return this._image.image.x.value+(this.canvasWidth/2-this._image.getWidth()/2)},t.prototype.resolvePersonalizedText=function(e){try{return o.TextTemplating.applyTextTemplatingToString(e,this._personalizationProperties)}catch(t){return u.default.error("Personalization Could not be resolved for: "+e),null}},t}(HTMLElement);t.default=l},186:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(403),o=n(12),a=n(79),u=function(e){function t(){var n=e.call(this)||this;return n._root=n.attachShadow({mode:"closed"}),n._root.appendChild(document.importNode(t.template().content,!0)),n._overlayElement=n._root.querySelector(".".concat(a.SWRVE_IAM_OVERLAY)),n._canvasElement=n._root.querySelector(".".concat(a.SWRVE_IAM_CANVAS)),n._styles=n._root.querySelector("style"),n}return i(t,e),Object.defineProperty(t.prototype,"animation",{get:function(){return this.getAttribute("animation")},set:function(e){this.setAttribute("animation",e.toString())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.getAttribute("position")},set:function(e){this.setAttribute("position",e.toString())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inAppConfig",{get:function(){return this._inAppConfig},set:function(e){this._inAppConfig=e},enumerable:!1,configurable:!0}),t.prototype.connectedCallback=function(){this._styles.textContent+=a.SWRVE_IAM_POSITIONS[this.position]},t.prototype.show=function(){this.renderMessage()},t.prototype.close=function(){this.removeMessage()},t.prototype.handleButtonClick=function(e){var t;this.dispatchEvent(new CustomEvent(a.SWRVE_IAM_BUTTON_CLICK_EVENT,{detail:{button:e,parentCampaign:null===(t=this._message)||void 0===t?void 0:t.parentCampaign}})),this.close()},t.prototype.renderMessage=function(){var e,t;this._canvasElement.style.width="".concat((null===(e=this.message)||void 0===e?void 0:e.canvasWidth)||0,"px"),this._canvasElement.style.height="".concat((null===(t=this.message)||void 0===t?void 0:t.canvasHeight)||0,"px"),this.appendImages(),this.appendButtons(),this._overlayElement.style.display="flex"},t.prototype.removeMessage=function(){this._overlayElement.style.display="none",this._canvasElement.style.width="0px",this._canvasElement.style.height="0px",this._canvasElement.innerHTML="",this._message=void 0},t.prototype.appendImages=function(){var e,t=this;null===(e=this._message)||void 0===e||e.images.forEach((function(e,n){var r,i=document.createElement("swrve-image");i.image=new s.SwrveImage(e,t._message.imagesCDN,null===(r=t._message)||void 0===r?void 0:r.personalizationProperties,t._message.scale),i.personalizationProperties=t._message.personalizationProperties,i.inAppConfig=t.inAppConfig,i.canvasHeight=t.message.canvasHeight,i.canvasWidth=t.message.canvasWidth,i.id="".concat(a.SWRVE_IAM_IMAGE,"-").concat(n),t._canvasElement.appendChild(i)}))},t.prototype.appendButtons=function(){var e,t=this;null===(e=this._message)||void 0===e||e.buttons.forEach((function(e,n){var r,i=document.createElement("swrve-button");i.button=new o.SwrveButton(e,t._message.imagesCDN,null===(r=t._message)||void 0===r?void 0:r.personalizationProperties,t._message.scale),i.personalizationProperties=t._message.personalizationProperties,i.inAppConfig=t.inAppConfig,i.onclick=function(){return t.handleButtonClick(e)},i.canvasHeight=t.message.canvasHeight,i.canvasWidth=t.message.canvasWidth,i.id="".concat(a.SWRVE_IAM_BUTTON,"-").concat(n),t._canvasElement.appendChild(i)}))},t.template=function(){var e=document.createElement("template");return e.innerHTML=a.SWRVE_IAM_TEMPLATE_LITERAL,e},t}(HTMLElement);t.default=u},79:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SWRVE_IAM_BUTTON_TEMPLATE_LITERAL=t.SWRVE_IAM_TEMPLATE_LITERAL=t.SWRVE_IAM_ENTER_ANIMATIONS=t.SWRVE_IAM_POSITIONS=t.SWRVE_IAM_DEFAULT_POSITION=t.SWRVE_IAM_DEFAULT_ENTER_ANIMATION=t.DEFAULT_IAM_TEXT_FONT=t.DEFAULT_IAM_TEXT_FOREGROUND_COLOR=t.DEFAULT_IAM_TEXT_BACKGROUND_COLOR=t.SWRVE_IAM_BUTTON_CLICK_EVENT=t.SWRVE_IAM_IMAGE=t.SWRVE_IAM_BUTTON=t.SWRVE_IAM_CANVAS=t.SWRVE_IAM_OVERLAY=t.SWRVE_IMAGE_BUTTON=t.SWRVE_TEXT_BUTTON=void 0,t.SWRVE_TEXT_BUTTON="text",t.SWRVE_IMAGE_BUTTON="image",t.SWRVE_IAM_OVERLAY="swrveIAM__overlay",t.SWRVE_IAM_CANVAS="swrveIAM__canvas",t.SWRVE_IAM_BUTTON="swrveIAM__button",t.SWRVE_IAM_IMAGE="swrveIAM__image",t.SWRVE_IAM_BUTTON_CLICK_EVENT="swrve-iam-button-click",t.DEFAULT_IAM_TEXT_BACKGROUND_COLOR="transparent",t.DEFAULT_IAM_TEXT_FOREGROUND_COLOR="#000000",t.DEFAULT_IAM_TEXT_FONT="Arial",t.SWRVE_IAM_DEFAULT_ENTER_ANIMATION="fadeInDown",t.SWRVE_IAM_DEFAULT_POSITION="center",t.SWRVE_IAM_POSITIONS={center:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: center;\n      align-items: center;\n    }\n  "),bottom:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: center;\n      align-items: end;\n    }\n  "),top:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: center;\n      align-items: baseline;\n    }\n  "),bottomRight:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: end;\n      align-items: end;\n    }\n\n    .").concat(t.SWRVE_IAM_CANVAS," {\n      margin: 20px;\n    }\n  "),topRight:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: end;\n      align-items: baseline;\n    }\n\n    .").concat(t.SWRVE_IAM_CANVAS," {\n      margin: 20px;\n    }\n  "),bottomLeft:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: start;\n      align-items: end;\n    }\n\n    .").concat(t.SWRVE_IAM_CANVAS," {\n      margin: 20px;\n    }\n  "),topLeft:"\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      justify-content: start;\n      align-items: baseline;\n    }\n\n    .").concat(t.SWRVE_IAM_CANVAS," {\n      margin: 20px;\n    }\n  ")},t.SWRVE_IAM_ENTER_ANIMATIONS={fadeInDown:{className:"fadeInDown",templateLiteral:"\n      @keyframes fadeInDown {\n        from {\n          opacity: 0;\n          transform: translate3d(0, -100%, 0);\n        }\n\n        to {\n          opacity: 1;\n          transform: translate3d(0, 0, 0);\n        }\n      }\n\n      .fadeInDown {\n        animation-name: fadeInDown;\n        animation-duration: 1.5s;\n      }\n    "},fadeInLeft:{className:"fadeInLeft",templateLiteral:"\n      @keyframes fadeInLeft {\n        from {\n          opacity: 0;\n          transform: translate3d(-2000px, 0, 0);\n        }\n\n        to {\n          opacity: 1;\n          transform: translate3d(0, 0, 0);\n        }\n      }\n\n      .fadeInLeft {\n        animation-name: fadeInLeft;\n        animation-duration: 1.5s;\n      }\n    "},fadeInRight:{className:"fadeInRight",templateLiteral:"\n      @keyframes fadeInRight {\n        from {\n          opacity: 0;\n          transform: translate3d(2000px, 0, 0);\n        }\n\n        to {\n          opacity: 1;\n          transform: translate3d(0, 0, 0);\n        }\n      }\n\n      .fadeInRight {\n        animation-name: fadeInRight;\n        animation-duration: 1.5s;\n      }\n    "},fadeInUp:{className:"fadeInUp",templateLiteral:"\n      @keyframes fadeInUp {\n        from {\n          opacity: 0;\n          transform: translate3d(0, 2000px, 0);\n        }\n\n        to {\n          opacity: 1;\n          transform: translate3d(0, 0, 0);\n        }\n      }\n\n      .fadeInUp {\n        animation-name: fadeInUpBig;\n        animation-duration: 1.5s;\n      }\n    "},bounceInDown:{className:"bounceInDown",templateLiteral:"\n      @keyframes bounceInDown {\n        from,\n        60%,\n        75%,\n        90%,\n        to {\n          animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);\n        }\n\n        0% {\n          opacity: 0;\n          transform: translate3d(0, -3000px, 0) scaleY(3);\n        }\n\n        60% {\n          opacity: 1;\n          transform: translate3d(0, 25px, 0) scaleY(0.9);\n        }\n\n        75% {\n          transform: translate3d(0, -10px, 0) scaleY(0.95);\n        }\n\n        90% {\n          transform: translate3d(0, 5px, 0) scaleY(0.985);\n        }\n\n        to {\n          transform: translate3d(0, 0, 0);\n        }\n      }\n\n      .bounceInDown {\n        animation-name: bounceInDown;\n        animation-duration: 1.5s;\n      }\n    "}},t.SWRVE_IAM_TEMPLATE_LITERAL="\n  <style>\n    .".concat(t.SWRVE_IAM_OVERLAY," {\n      position: fixed;\n      left: 0;\n      top: 0;\n      height: 100vh;\n      width: 100vw;\n      background-color: rgb(0,0,0,.8);\n      z-index: 1050;\n      display: none;\n    }\n\n    .").concat(t.SWRVE_IAM_CANVAS," {\n      position: relative;\n    }\n\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n      }\n\n      to {\n        opacity: 1;\n      }\n    }\n\n    .fadeIn {\n      animation-name: fadeIn;\n      animation-duration: .5s;\n    }\n  </style>\n\n  <div class='swrveIAM__overlay fadeIn'>\n    <div class='swrveIAM__canvas'></div>\n  </div>\n"),t.SWRVE_IAM_BUTTON_TEMPLATE_LITERAL='\n    <style>\n      button {\n        background: none;\n        color: inherit;\n        border: none;\n        padding: 0;\n        font: inherit;\n        cursor: pointer;\n        outline: inherit;\n        position: absolute;\n      }\n\n      button:focus {\n        box-shadow: 0 0 0 0.2rem rgb(0 123 255 / 50%);\n      }\n\n      button:hover {\n        opacity: 60%;\n      }\n    </style>\n\n    <button class="'.concat(t.SWRVE_IAM_BUTTON,'" role="button"></button>\n')},594:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveMessageDisplayManager=void 0,n(698);var s=i(n(186)),o=i(n(297)),a=i(n(638)),u=function(){function e(e,t){this.onButtonClickedCallback=null,this.isOpen=!1,this.justClosed=!1,this.swrveIAM=document.createElement("swrve-in-app-message"),this.keymap=e.getKeymapping(),this.registerSwrveElements(),t?this.initSwrveIAM("none","center",t.InAppMessageConfig):this.initSwrveIAM("none","center"),this.initButtonClickListener()}return e.prototype.showMessage=function(e,t,n,i){var s=this.getLandscapeFormat(e);s&&(this.isOpen=!0,this.swrveIAM.message=r({personalizationProperties:i,imagesCDN:n,parentCampaign:t,scale:s.scale,images:s.images,buttons:s.buttons},this.getCanvasDimensions(s)),this.swrveIAM.show())},e.prototype.onButtonClicked=function(e){this.onButtonClickedCallback=e},e.prototype.isIAMShowing=function(){return this.isOpen},e.prototype.closeMessage=function(){this.isOpen=!1,this.justClosed=!0,this.swrveIAM.close()},e.prototype.initSwrveIAM=function(e,t,n){this.swrveIAM.setAttribute("animation",e),this.swrveIAM.setAttribute("position",t),this.swrveIAM.inAppConfig=n,document.body.appendChild(this.swrveIAM)},e.prototype.registerSwrveElements=function(){window.customElements.get("swrve-in-app-message")||window.customElements.define("swrve-in-app-message",s.default),window.customElements.get("swrve-button")||window.customElements.define("swrve-button",o.default),window.customElements.get("swrve-image")||window.customElements.define("swrve-image",a.default)},e.prototype.initButtonClickListener=function(){var e=this;this.swrveIAM.addEventListener("swrve-iam-button-click",(function(t){t.preventDefault(),t.stopImmediatePropagation(),e.closeMessage(),e.onButtonClickedCallback&&e.onButtonClickedCallback(t.detail.button,t.detail.parentCampaign)}))},e.prototype.getLandscapeFormat=function(e){var t=e.template.formats||null;if(!t)return null;var n=null;return t.forEach((function(e){"landscape"===e.orientation&&(n=e)})),n},e.prototype.getCanvasDimensions=function(e){var t;return(t=0!=e.images.length?e.images.find((function(e){return"Background"===e.name})):e.buttons.find((function(e){return"Background"===e.name})))?{canvasWidth:t.dynamic_image_url?t.w.value:t.image_width,canvasHeight:t.dynamic_image_url?t.h.value:t.image_height}:{canvasWidth:100,canvasHeight:100}},e}();t.SwrveMessageDisplayManager=u},12:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveButton=void 0;var i=n(151),s=r(n(936)),o=function(){function e(e,t,n,r){this._button=e,this._cdn=t,this._scale=r,this._hasDynamicUrl=!!this._button.dynamic_image_url,this._isSingleLineText=!!this._button.text,this._personalizationProperties=n}return Object.defineProperty(e.prototype,"button",{get:function(){return this._button},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasDynamicUrl",{get:function(){return this._hasDynamicUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSingleLineText",{get:function(){return this._isSingleLineText},enumerable:!1,configurable:!0}),e.prototype.getAssetID=function(){return this.button.image_up?this.resolveOrFallbackUrlPersonalization(this.button.image_up.value):this.resolveOrFallbackUrlPersonalization("")},e.prototype.getAssetPath=function(){return this.button.image_up?this.resolveOrFallbackUrlPersonalization("".concat(this._cdn).concat(this.button.image_up.value)):this.resolveOrFallbackUrlPersonalization("")},e.prototype.canRender=function(){return this.isSingleLineText?null!==this.resolveTextTemplating(this.button.text.value,this._personalizationProperties):!(!this.hasDynamicUrl||null===this.resolveTextTemplating(this._button.dynamic_image_url,this._personalizationProperties))||void 0!==this._button.image_up},e.prototype.getWidth=function(){return this.hasDynamicUrl?this.button.w.value:this.button.image_width},e.prototype.getHeight=function(){return this.hasDynamicUrl?this.button.h.value:this.button.image_height},e.prototype.resolveOrFallbackUrlPersonalization=function(e){if(this.hasDynamicUrl)try{var t=i.TextTemplating.applyTextTemplatingToString(this.button.dynamic_image_url,this._personalizationProperties);if(null!==t)return t}catch(e){}return e},e.prototype.resolveTextTemplating=function(e,t){try{var n=i.TextTemplating.applyTextTemplatingToString(e,t);if(null!==n)return n}catch(t){s.default.debug("Could not resolve personalization for: "+e)}return null},e}();t.SwrveButton=o},327:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={primaryNext:"Right",primaryPrev:"Left"},r={primaryNext:"Down",primaryPrev:"Up"},i={horizontal:n,vertical:r,bidirectional:null},s=function(){function e(e,t){this.index=0,this.props=t,this.items=e}return e.prototype.onFocus=function(){var e=this.items[this.index];e&&this.props.onFocus(e)},e.prototype.onBlur=function(){var e=this.items[this.index];e&&this.props.onBlur(e)},e.prototype.onKeyPress=function(e){var t=this.items[this.index];if(this.props.onKeyPress&&t&&this.props.onKeyPress(t,e))return!0;var s=this.props.direction;return"bidirectional"===s?this.handleDirection(r,e)||this.handleDirection(n,e):this.handleDirection(i[s||"vertical"]||r,e)},e.prototype.setItems=function(e){this.items=e},e.prototype.getItems=function(){return this.items},e.prototype.getCurrentIndex=function(){return this.index},e.prototype.setActiveItem=function(e){return e>=0&&e<this.items.length&&(this.props.onBlur(this.items[this.index]),this.index=e,this.props.onFocus(this.items[this.index])),!0},e.prototype.setActiveFirst=function(){this.setActiveItem(0)},e.prototype.setActiveLast=function(){this.setActiveItem(this.items.length-1)},e.prototype.handleDirection=function(e,t){var n=e.primaryNext;return t===e.primaryPrev?this.setActiveItem(this.index-1):t===n&&this.setActiveItem(this.index+1)},e}();t.default=s},403:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveImage=void 0;var i=n(151),s=r(n(936)),o=function(){function e(e,t,n,r){this._image=e,this._cdn=t,this._scale=r,this._hasDynamicUrl=!!this._image.dynamic_image_url,this._isSingleLineText=!!this._image.text,this._personalizationProperties=n}return Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasDynamicUrl",{get:function(){return this._hasDynamicUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSingleLineText",{get:function(){return this._isSingleLineText},enumerable:!1,configurable:!0}),e.prototype.canRender=function(){return this.isSingleLineText?null!==this.resolveTextTemplating(this.image.text.value,this._personalizationProperties):!(!this.hasDynamicUrl||null===this.resolveTextTemplating(this._image.dynamic_image_url,this._personalizationProperties))||void 0!==this._image.image},e.prototype.getAssetID=function(){return this._image.image?this.resolveOrFallbackUrlPersonalization(this._image.image.value):this.resolveOrFallbackUrlPersonalization("")},e.prototype.getAssetPath=function(){return this._image.image?this.resolveOrFallbackUrlPersonalization("".concat(this._cdn).concat(this.image.image.value)):this.resolveOrFallbackUrlPersonalization("")},e.prototype.getWidth=function(){return this.hasDynamicUrl?this.image.w.value:this.image.image_width},e.prototype.getHeight=function(){return this.hasDynamicUrl?this.image.h.value:this.image.image_height},e.prototype.resolveOrFallbackUrlPersonalization=function(e){if(this.hasDynamicUrl){var t=this.resolveTextTemplating(this._image.dynamic_image_url,this._personalizationProperties);if(null!==t)return t}return e},e.prototype.resolveTextTemplating=function(e,t){try{var n=i.TextTemplating.applyTextTemplatingToString(e,t);if(null!==n)return n}catch(t){return s.default.debug("Could not resolve personalization for: "+e),null}return null},e}();t.SwrveImage=o},863:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.appID=e.appId,this.apiKey=e.apiKey,this.stack=e.stack||"us",this.language=e.language||"English",this.newSessionInterval=e.newSessionInterval||1800,this.eventsUrl=this.resolveEventsUrl(e),this.contentUrl=this.resolveContentUrl(e),this.identityUrl=this.resolveIdentityUrl(e),this.appVersion=e.appVersion||"1.0",this.appStore=e.appStore||"web",this.httpsTimeoutSeconds=e.httpsTimeoutSeconds||10,this.inAppMessageConfig=e.inAppMessageConfig||{autoShowMessagesMaxDelay:5e3},this.externalUserId=e.externalUserId||null,this.embeddedMessageConfig=e.embeddedMessageConfig||{},this.personalizationProvider=e.personalizationProvider||null,this.webPushConfig=e.webPushConfig||{webApiKeyCallback:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},autoPushSubscribe:!1}}return Object.defineProperty(e.prototype,"AppID",{get:function(){return this.appID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ApiKey",{get:function(){return this.apiKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EventsUrl",{get:function(){return this.eventsUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ContentUrl",{get:function(){return this.contentUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IdentityUrl",{get:function(){return this.identityUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Stack",{get:function(){return this.stack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AppVersion",{get:function(){return this.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AppStore",{get:function(){return this.appStore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"HttpsTimeoutSeconds",{get:function(){return this.httpsTimeoutSeconds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"StartupExternalUserId",{get:function(){return this.externalUserId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Language",{get:function(){return this.language},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"NewSessionInterval",{get:function(){return this.newSessionInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"InAppMessageConfig",{get:function(){return this.inAppMessageConfig},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EmbeddedMessageConfig",{get:function(){return this.embeddedMessageConfig},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"PersonalizationProvider",{get:function(){return this.personalizationProvider},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"WebPushConfig",{get:function(){return this.webPushConfig},enumerable:!1,configurable:!0}),e.prototype.getReadonlyVersion=function(){return{appId:this.appID,apiKey:this.ApiKey,stack:this.stack,httpsTimeoutSeconds:this.HttpsTimeoutSeconds,contentUrl:this.ContentUrl,eventsUrl:this.EventsUrl,identityUrl:this.IdentityUrl,appStore:this.AppStore,appVersion:this.AppVersion,language:this.Language,newSessionInterval:this.NewSessionInterval,inAppMessageConfig:this.InAppMessageConfig,embeddedMessageConfig:this.embeddedMessageConfig,personalizationProvider:this.personalizationProvider,webPushConfig:this.webPushConfig}},e.prototype.resolveEventsUrl=function(e){var t="eu"===e.stack?"eu-api":"api";return e.eventsUrl||"https://".concat(e.appId,".").concat(t,".swrve.com")},e.prototype.resolveContentUrl=function(e){var t="eu"===e.stack?"eu-content":"content";return e.contentUrl||"https://".concat(e.appId,".").concat(t,".swrve.com")},e.prototype.resolveIdentityUrl=function(e){var t="eu"===this.stack?"eu-identity":"identity";return e.identityUrl||"https://".concat(e.appId,".").concat(t,".swrve.com/identify")},e}();t.default=n},586:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventFactory=void 0;var i=n(660),s=r(n(756)),o=function(){function e(){}return e.prototype.getNamedEvent=function(e,t,n,r){return{type:"event",time:r,seqnum:n,name:e,payload:t}},e.prototype.getUserUpdate=function(e,t,n){return{type:"user",time:n,seqnum:t,attributes:e}},e.prototype.getUserUpdateWithDate=function(e,t,n,r){var i;return{type:"user",time:r,seqnum:n,attributes:(i={},i[e]=s.default.dateToSwrveISOString(t),i)}},e.prototype.getDeviceUpdate=function(e,t,n){return{type:"device_update",time:n,seqnum:t,attributes:e}},e.prototype.getPurchaseEvent=function(e,t,n,r,i,s){return{type:"purchase",time:s,seqnum:i,quantity:r,item:e,cost:n,currency:t}},e.prototype.getInAppPurchaseEventWithoutReceipt=function(e,t,n,r,s,o,a){return null!=a&&(0,i.validateRewards)(a),{type:"iap",time:o,seqnum:s,quantity:e,product_id:t,app_store:"unknown_store",cost:n,local_currency:r,rewards:a}},e.prototype.getStartSessionEvent=function(e,t){return{type:"session_start",time:t,seqnum:e}},e.prototype.getCurrencyGivenEvent=function(e,t,n,r){return{type:"currency_given",time:r,seqnum:n,given_amount:t,given_currency:e}},e.prototype.getFirstInstallEvent=function(e,t){return{type:"event",time:e,seqnum:t,name:"Swrve.first_session"}},e.prototype.getButtonClickEvent=function(e,t,n,r){return{type:"event",time:s.default.nowInUtcTime(),seqnum:e,name:"Swrve.Messages.Message-"+t.id+".click",payload:{name:n,embedded:r}}},e.prototype.getImpressionEvent=function(e,t,n){return{type:"event",time:s.default.nowInUtcTime(),seqnum:t,name:"Swrve.Messages.Message-"+e.id+".impression",payload:n}},e.prototype.getCampaignTriggeredEvent=function(e,t,n,r,i){return void 0===i&&(i=[]),{event_name:e,event_payload:t,displayed:r,reason:n,campaigns:i}},e}();t.EventFactory=o},169:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0;var a=n(133),u=o(n(936)),c=n(860),l=o(n(100)),p=function(){function e(e,t,n,r,i){this.restClient=e,this.storageManager=t,this.MAX_QUEUE_SIZE=1e5,this._queueSize=0,this.queue=[],this.config=n,this.profileManager=r,this.deviceId=i}return e.prototype.queueEvent=function(e){u.default.debug("QUEUE EVENT",e),this.queue.push(e),this.calculateQueueSize(e)},e.prototype.getQueue=function(){return this.queue},e.prototype.clearQueue=function(){this.queue=[],this._queueSize=0},e.prototype.clearQueueAndStorage=function(e){this.clearQueue(),this.storageManager.clearData("events"+e)},Object.defineProperty(e.prototype,"queueSize",{get:function(){return this._queueSize},enumerable:!1,configurable:!0}),e.prototype.sendQueue=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(r){return t=this.getAllQueuedEvents(e),this.clearStoredEvents(e),this.clearQueue(),t.length>0?[2,this.postQueuedEvents(t).then((function(){return!0})).catch((function(r){return u.default.error("Error sending events :: ".concat(r.name," - ").concat(r.message)),r instanceof l.default!=0&&500!==r.code||n.storeEvents(s(s([],t,!0),n.getAllQueuedEvents(e),!0),e),!1}))]:[2,Promise.resolve(!1)]}))}))},e.prototype.getAllQueuedEvents=function(e){return s(s([],this.queue,!0),this.getStoredEvents(e),!0)},e.prototype.getStoredEvents=function(e){var t=this.storageManager.getData(this.getStorageKey(e));try{return t?JSON.parse(t):[]}catch(e){return[]}},e.prototype.saveEventsToStorage=function(e){if(this.queue.length>0){var t=this.getAllQueuedEvents(e);this.clearQueue(),this.storeEvents(t,e)}else u.default.info("nothing to save")},e.prototype.storeEvents=function(e,t){var n=JSON.stringify(e);this.storageManager.saveData(this.getStorageKey(t),n),this._queueSize+=(0,a.getStringSize)(n)-Math.max(e.length-1,0)-2},e.prototype.calculateQueueSize=function(e){var t=JSON.stringify(e);this._queueSize+=(0,a.getStringSize)(t)},e.prototype.clearStoredEvents=function(e){this.storageManager.clearData(this.getStorageKey(e))},e.prototype.getStorageKey=function(e){return"events"+e},e.prototype.postQueuedEvents=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t="".concat(this.config.EventsUrl,"/1/batch"),n={user:this.profileManager.currentUser.userId,app_version:this.config.AppVersion,session_token:this.profileManager.getSessionToken(),version:c.SWRVE_EVENTS_API_VERSION,unique_device_id:this.deviceId,data:e},[4,this.restClient.post(t,n)];case 1:return[2,r.sent()]}}))}))},e}();t.EventManager=p},660:(e,t)=>{"use strict";function n(e){if(!isFinite(e.amount)||e.amount<=0)throw new Error("Reward amount must be a positive number.")}Object.defineProperty(t,"__esModule",{value:!0}),t.validateReward=t.validateRewards=void 0,t.validateRewards=function(e){for(var t=0,r=Object.keys(e);t<r.length;t++){var i=r[t];if(null==i||""===i)throw new Error("Reward resource name cannot be empty.");n(e[i])}},t.validateReward=n},741:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.QALogging=void 0;var a=n(860),u=o(n(936)),c=n(133),l=o(n(100)),p=o(n(756)),h="sdk",g="qa_log_event",f="event",d=function(){function e(e,t,n,r){this.restClient=e,this.config=t,this.profileManager=n,this.deviceId=r,this.qaLogFlushFrequencyMilliseconds=5e3,this.MAX_QUEUE_SIZE=1e5,this.qaLogTimer=0,this._queueSize=0,this.queue=[]}return e.prototype.shouldBeLogging=function(){return this.profileManager.isQAUser()},e.prototype.startQALogTimer=function(){var e=this;u.default.debug("Started QA Logging..."),this.qaLogTimer=setInterval((function(){return e.sendQueue()}),this.qaLogFlushFrequencyMilliseconds)},e.prototype.stopQALogTimer=function(){u.default.debug("Stopped QA Logging..."),clearInterval(this.qaLogTimer)},e.prototype.namedEvent=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"event",parameters:{name:e.name,payload:e.payload},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.userUpdate=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"user",parameters:{attributes:e.attributes},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.userUpdateWithDate=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"user",parameters:{attributes:e.attributes},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.deviceUpdate=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"device_update",parameters:{attributes:e.attributes},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.purchaseEvent=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"purchase",parameters:{quantity:e.quantity,item:e.item,cost:e.cost,currency:e.currency},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.inAppPurchaseEventWithoutReceipt=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"iap",parameters:{product_id:e.product_id,app_store:e.app_store,rewards:e.rewards,cost:e.cost,local_currency:e.local_currency},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.sessionStart=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"session_start",parameters:{},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.currencyGivenEvent=function(e){if(this.shouldBeLogging()){var t={log_source:h,log_details:{type:"currency_given",parameters:{given_amount:e.given_amount,given_currency:e.given_currency},seqnum:e.seqnum,client_time:e.time},type:g,time:e.time,log_type:f};this.queueQAEvent(t)}},e.prototype.campaignTriggeredEvent=function(e,t){if(this.shouldBeLogging()){var n={type:"qa_log_event",log_type:"campaign-triggered",seqnum:e,time:p.default.nowInUtcTime(),log_source:"sdk",log_details:t};this.queueQAEvent(n)}},e.prototype.campaignsDownloadedEvent=function(e,t){if(this.shouldBeLogging()){var n={log_source:h,log_details:{campaigns:t},seqnum:e,type:g,time:p.default.nowInUtcTime(),log_type:"campaigns-downloaded"};this.queueQAEvent(n)}},e.prototype.buttonClickEvent=function(e,t,n,r,i,s){if(this.shouldBeLogging()){var o=void 0;switch(r){case a.DISMISS:o="dismiss";break;case a.CUSTOM:o="deeplink"}var u={type:"qa_log_event",log_type:"campaign-button-clicked",seqnum:s,time:p.default.nowInUtcTime(),log_source:"sdk",log_details:{campaign_id:e,variant_id:t,button_name:n,action_type:o,action_value:i}};this.queueQAEvent(u)}},e.prototype.getQueue=function(){return s([],this.queue,!0)},e.prototype.sendQueue=function(){return r(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(n){return(e=this.getQueue()).length>0?(this.clearQueue(),u.default.debug("Sending QA Log Queue",e),[2,this.postQueuedQAEvents(e).then((function(){return!0})).catch((function(n){return u.default.error("Error sending events :: ".concat(n.name," - ").concat(n.message)),n instanceof l.default!=0&&500!==n.code||(t.queue=s(s([],t.queue,!0),e,!0)),!1}))]):[2,Promise.resolve(!1)]}))}))},Object.defineProperty(e.prototype,"queueSize",{get:function(){return this._queueSize},enumerable:!1,configurable:!0}),e.prototype.clearQueue=function(){this.queue=[],this._queueSize=0},e.prototype.queueQAEvent=function(e){this.queue.push(e),this.calculateQueueSize(e)},e.prototype.calculateQueueSize=function(e){var t=JSON.stringify(e);this._queueSize+=(0,c.getStringSize)(t)},e.prototype.postQueuedQAEvents=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t="".concat(this.config.EventsUrl,"/1/batch"),n={user:this.profileManager.currentUser.userId,app_version:this.config.AppVersion,session_token:this.profileManager.getSessionToken(),version:a.SWRVE_EVENTS_API_VERSION,unique_device_id:this.deviceId,data:e},[4,this.restClient.post(t,n)];case 1:return[2,r.sent()]}}))}))},e}();t.QALogging=d},869:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileManager=void 0;var i=n(412),s=r(n(936)),o=n(378),a=r(n(756)),u=function(){function e(e,t,n,r,s){this.userId=e,this.appId=t,this.apiKey=n,this.newSessionInterval=r,this.storageManager=s;var o=this.storageManager.getData(e),u=(0,i.getSessionToken)(this.userId,this.appId,this.apiKey,new Date);o?(this._currentUser=JSON.parse(o),this.resolveCurrentUser(u)):this._currentUser={userId:e,sessionToken:u,sessionStart:a.default.nowInUtcTime(),isQAUser:!1,nextSeqNum:0,firstUse:0,lastSessionEnd:0,isAnonymous:!0},this.storageManager.saveData(e,JSON.stringify(this._currentUser))}return e.prototype.hasSessionRestored=function(){if(0!==this.currentUser.lastSessionEnd){var e=this.currentUser.lastSessionEnd,t=Number(a.default.nowInUtcTime()),n=1e3*this.newSessionInterval;s.default.debug("current time ".concat(t)),s.default.debug("lastSession: ".concat(e));var r=t-e;return s.default.debug("Diff now - lastSession: ".concat(r)),e&&r>n?(s.default.debug("session has expired."),!1):(s.default.debug("session still active"),!0)}return s.default.debug("no session. treating as expired"),!1},e.prototype.getNextSequenceNumber=function(){var e=++this._currentUser.nextSeqNum;return this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser)),e},e.prototype.getSessionToken=function(){return this._currentUser.sessionToken},e.prototype.getSwrveIdByExternalUserID=function(e){var t=this.storageManager.getData("ext-".concat(e));return null!==t?t:null},e.prototype.cacheExternalUserID=function(e,t){this.storageManager.saveData("ext-".concat(e),t)},e.prototype.storeUserId=function(e){this.storageManager.saveData("user_id",e)},e.prototype.getStoredUserId=function(){return this.storageManager.getData("user_id")},e.prototype.isUserIdVerified=function(e){return!!this.storageManager.getData("verified-"+e)},e.prototype.setUserIdAsVerified=function(e){this.isUserIdVerified(e)||this.storageManager.saveData("verified-"+e,"VERIFIED")},e.prototype.setCurrentUserAsNewAnonymousUser=function(){var e=(0,o.generateUuid)().toString();this.setCurrentUser(e,!0)},e.prototype.setCurrentUser=function(e,t,n){void 0===t&&(t=!1);var r=(0,i.getSessionToken)(e,this.appId,this.apiKey,new Date),s=this.storageManager.getData(e);s?(this._currentUser=JSON.parse(s),this.resolveCurrentUser(r)):this._currentUser={userId:e,sessionToken:r,sessionStart:a.default.nowInUtcTime(),isQAUser:!1,nextSeqNum:1,firstUse:0,lastSessionEnd:0,isAnonymous:t,externalUserId:n},this.storageManager.saveData(e,JSON.stringify(this._currentUser)),this.storageManager.saveData("user_id",this.currentUser.userId)},Object.defineProperty(e.prototype,"firstUse",{set:function(e){this.currentUser.firstUse=e,this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUser",{get:function(){return this._currentUser},enumerable:!1,configurable:!0}),e.prototype.setExternalUserId=function(e){this.currentUser.externalUserId=e,this.currentUser.isAnonymous=!1,this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser))},e.prototype.setAsQAUser=function(e){this.currentUser.isQAUser=!0,this.currentUser.qaUser=e,this.storageManager.saveData(this.currentUser.userId,JSON.stringify(this._currentUser))},e.prototype.clearQAUser=function(){this.currentUser.isQAUser=!1,this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser))},e.prototype.isQAUser=function(){return this._currentUser.isQAUser},Object.defineProperty(e.prototype,"QAUser",{get:function(){return this.isQAUser()?this._currentUser.qaUser:void 0},enumerable:!1,configurable:!0}),e.prototype.storeEtagHeader=function(e){s.default.info("New Etag "+e+" Old etag "+this._currentUser.etag),this._currentUser.etag=e,this.storageManager.saveData(this.currentUser.userId,JSON.stringify(this._currentUser))},e.prototype.clearEtagHeader=function(){this.currentUser.etag=void 0,this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser))},e.prototype.saveCurrentUserBeforeSessionEnd=function(){this._currentUser.lastSessionEnd=a.default.nowInUtcTime(),this.storageManager.saveData(this._currentUser.userId,JSON.stringify(this._currentUser)),this.storageManager.saveData("user_id",this.currentUser.userId),s.default.debug("saved last session end: ".concat(this._currentUser.lastSessionEnd))},e.prototype.resolveCurrentUser=function(e){var t=this._currentUser.userId;if(this.hasSessionRestored()){if(!this._currentUser.sessionStart){var n=new Date(this._currentUser.sessionStart);e=(0,i.getSessionToken)(t,this.appId,this.apiKey,n)}this.restoreCurrentUser(e,t,this._currentUser.sessionStart)}else this.restoreCurrentUser(e,t,a.default.nowInUtcTime())},e.prototype.restoreCurrentUser=function(e,t,n){this._currentUser.sessionToken=e,this._currentUser.sessionStart=n,this._currentUser.userId=t},e}();t.ProfileManager=u},299:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManager=void 0;var n=function(){function e(e,t){this.getResources=e,this.getResource=t}return e.prototype.getAttributeAsString=function(e,t,n){return this.getResource(e).getAttributeAsString(t,n)},e.prototype.getAttributeAsNumber=function(e,t,n){return this.getResource(e).getAttributeAsNumber(t,n)},e.prototype.getAttributeAsBoolean=function(e,t,n){return this.getResource(e).getAttributeAsBoolean(t,n)},e}();t.ResourceManager=n},687:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManagerInternal=void 0;var o=n(299),a=n(840),u=function(){function e(e){var t=this;this.storageManager=e,this.resourceManager=new o.ResourceManager((function(){return t.resources?t.resources.map((function(e){return r({},e)})):null}),(function(e){return t.resourcesIndex&&t.resourcesIndex[e]||new a.SwrveResource({})}))}return e.prototype.storeResources=function(e,t){this.setResources(e),this.storageManager.saveDataWithMD5Hash("resources"+t,JSON.stringify(e))},e.prototype.getResources=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){return[2,this.storageManager.getDataWithMD5Hash("resources"+e).then((function(e){var n=null;return e&&(n=JSON.parse(e)),t.setResources(n),n}))]}))}))},e.prototype.getResourceManager=function(){return this.resourceManager},e.prototype.setResources=function(e){this.resources=e,this.resourcesIndex=(e||[]).reduce((function(e,t){return e[t.uid]=new a.SwrveResource(t),e}),{})},e}();t.ResourceManagerInternal=u},840:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveResource=void 0,t.SwrveResource=function(e){e="object"==typeof e?e:{},this.getAttributeAsString=function(t,n){return t in e?String(e[t]):n},this.getAttributeAsNumber=function(t,n){if(t in e){var r=Number(e[t]);if(!isNaN(r))return r}return n},this.getAttributeAsBoolean=function(t,n){if(t in e){var r=e[t];return!!String(r).match(/^true|yes$/i)}return n},this.toJSON=function(){return n({},e)}}},100:function(e,t){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(n,r){var i=e.call(this,r)||this;return i.name="SwrveHttpError",i.code=n,Object.setPrototypeOf(i,t.prototype),i}return r(t,e),t}(Error);t.default=i},215:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveRestClient=void 0;var a=o(n(100)),u=function(){function e(){}return e.prototype.get=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r({method:"GET"},t),[4,this.http(new Request(e,n))];case 1:return[2,i.sent()]}}))}))},e.prototype.post=function(e,t,n){return i(this,void 0,void 0,(function(){var i;return s(this,(function(s){switch(s.label){case 0:return i=r({method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:new Headers([["Content-Type","application/json"]])},n),[4,this.http(new Request(e,i))];case 1:return[2,s.sent()]}}))}))},e.prototype.http=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:if(!(t=r.sent()).ok)throw new a.default(t.status,t.statusText);return n={etag:t.headers.get("etag")},[4,t.json().catch((function(){}))];case 2:return[2,(n.data=r.sent(),n)]}}))}))},e}();t.SwrveRestClient=u},633:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0;var r=n(57),i=n(860),s=function(){function e(e){this.platform=e}return e.prototype.saveData=function(e,t){this.getStorage().setItem(this.getKey(e),t)},e.prototype.getData=function(e){return this.getStorage().getItem(this.getKey(e))},e.prototype.clearData=function(e){this.getStorage().removeItem(this.getKey(e))},e.prototype.saveDataWithMD5Hash=function(e,t){var n=this,i=this.getStorage();return(0,r.md5Async)(e+t).then((function(r){i.setItem(n.getKey(e),t),i.setItem(n.getHashKey(e),r)}))},e.prototype.getDataWithMD5Hash=function(e){var t=this.getStorage(),n=t.getItem(this.getKey(e)),i=t.getItem(this.getHashKey(e));return(0,r.md5Async)(e+n).then((function(e){return i===e?n:null}))},e.prototype.getKey=function(e){return"swrve."+e},e.prototype.getHashKey=function(e){return"swrve."+e+".hash"},e.prototype.getStorage=function(){var e=this.platform.synchronousStorage;if(!e)throw new Error(i.NO_SYNCHRONOUS_STORAGE);return e},e}();t.StorageManager=s},14:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Swrve=void 0;var c=n(586),l=n(869),p=n(607),h=n(70),g=n(687),f=s(n(860)),d=n(633),_=u(n(936)),v=n(169),m=n(86),y=n(215),E=n(899),S=n(978),b=n(860),w=u(n(863)),I=n(378),C=n(741),A=n(30),M=n(151),T=u(n(756)),N=function(){function e(e,t){var n=this;if(this.onResourcesLoadedCallback=null,this.onCampaignLoadedCallback=null,this.onCustomButtonClickedCallback=null,this.onDismissButtonCallback=null,this.onClipboardButtonCallback=null,this.eventLoopTimer=0,this.flushFrequency=0,this._shutdown=!1,this.autoShowEnabled=!0,this.pauseSDK=!1,this.identifiedOnlyTracking=!1,this.installDate="",this.identifiedOnAnotherDevice=!1,this.webPushApiKey="",null==t.platform)throw new Error(f.REQUIRED_DEPENDENCY_PLATFORM);this.platform=t.platform,this.storageManager=new d.StorageManager(this.platform),this.loadInstallDate();var r=this.storageManager.getData(f.SWRVE_USER_ID_NO_PREFIX);_.default.debug("last user ID: ".concat(r)),null===r&&(r=(0,I.generateUuid)().toString()),this.config=new w.default(e),this.resourceManager=new g.ResourceManagerInternal(this.storageManager),this.restClient=t.restClient||new y.SwrveRestClient,this.profileManager=t.profileManager||new l.ProfileManager(r,this.config.AppID,this.config.ApiKey,this.config.NewSessionInterval,this.storageManager),this.campaignManager=t.campaignManager||new p.CampaignManager(this.profileManager,this.platform,this.storageManager,this.config),this.realTimeUserPropertiesManager=new m.RealTimeUserPropertiesManager(this.profileManager,this.storageManager),this.platform.name().variation==f.WEB_PLATFORM&&(this.identifiedOnlyTracking=!0,this.pauseSDK=!0,_.default.debug("Identified-only tracking: enabled")),this.config.EmbeddedMessageConfig&&this.config.EmbeddedMessageConfig.embeddedCallback&&("function"!=typeof this.config.EmbeddedMessageConfig.embeddedCallback&&_.default.error(f.INVALID_FUNCTION.replace("$","onEmbeddedMessage")),this.campaignManager.onEmbeddedMessage(this.config.EmbeddedMessageConfig.embeddedCallback)),this.campaignManager.onButtonClicked((function(e,t){return n.handleButtonClicked(e,t)})),this.evtManager=t.eventManager||new v.EventManager(this.restClient,this.storageManager,this.config,this.profileManager,this.platform.deviceID),this.eventFactory=new c.EventFactory,this.qaLogging=new C.QALogging(this.restClient,this.config,this.profileManager,this.platform.deviceID)}return e.prototype.init=function(e){this.profileManager.storeUserId(this.profileManager.userId),this.onSwrveCoreReadyCallback=e,this.identifiedOnlyTracking?this.nonAnonTrackingInit():this.anonPermittedTrackingInit()},e.prototype.setupInAppConfiguration=function(e){e.inAppMessageConfig&&(e.inAppMessageConfig.customButtonListener&&"function"==typeof e.inAppMessageConfig.customButtonListener&&(this.onCustomButtonClickedCallback=e.inAppMessageConfig.customButtonListener),e.inAppMessageConfig.dismissButtonListener&&"function"==typeof e.inAppMessageConfig.dismissButtonListener&&(this.onDismissButtonCallback=e.inAppMessageConfig.dismissButtonListener),e.inAppMessageConfig.clipboardButtonListener&&"function"==typeof e.inAppMessageConfig.clipboardButtonListener&&(this.onClipboardButtonCallback=e.inAppMessageConfig.clipboardButtonListener))},e.prototype.nonAnonTrackingInit=function(){var e=this,t=this.config.StartupExternalUserId;this.profileManager.currentUser.userId,this.identify(t,(function(t,n){_.default.debug("identified successfully: "+t+" userId: "+n),e.anonPermittedTrackingInit()}),(function(e){_.default.error(e)}))},e.prototype.anonPermittedTrackingInit=function(){var e=this;window.onbeforeunload=function(){e.pageStateHandler(),e.shutdown()},window.onblur=function(){e.pageStateHandler()},this.platform.init(["language","countryCode","timezone","firmware"]).then((function(){e._shutdown||e.queueDeviceProperties()})),this.initSDK()},e.prototype.getConfig=function(){return this.config.getReadonlyVersion()},e.prototype.getUserId=function(){return this.profileManager.currentUser.userId},e.prototype.getExternalUserId=function(){var e=this.profileManager.currentUser.externalUserId;return null!=e?e:null},e.prototype.getPlatform=function(){return this.platform},e.prototype.getSDKVersion=function(){return this.platform.sdkVersion},e.prototype.getWebPushApiKey=function(){return this.webPushApiKey},e.prototype.getQALogging=function(){return this.qaLogging},e.prototype.getUserInfo=function(){var e=this.profileManager.currentUser;return{userId:e.userId,externalUserId:e.externalUserId,firstUse:e.firstUse,sessionStart:e.sessionStart,isQAUser:e.isQAUser}},e.prototype.getMessageCenterCampaigns=function(e){var t=this.retrievePersonalizationProperties(void 0,e);return this.campaignManager.getMessageCenterCampaigns(t)},e.prototype.event=function(e,t){if(!this.pauseSDK){this.validateEventName(e);var n=this.eventFactory.getNamedEvent(e,t,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(n),this.qaLogging.namedEvent(n),this.checkTriggers(e,t)}},e.prototype.userUpdateWithDate=function(e,t){if(!this.pauseSDK){this.validateEventName(e);var n=this.eventFactory.getUserUpdateWithDate(e,t,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(n),this.qaLogging.userUpdateWithDate(n)}},e.prototype.deviceUpdate=function(e){if(!this.pauseSDK){var t=this.eventFactory.getDeviceUpdate(e,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(t),this.qaLogging.deviceUpdate(t)}},e.prototype.userUpdate=function(e){if(!this.pauseSDK){var t=this.eventFactory.getUserUpdate(e,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(t),this.qaLogging.userUpdate(t)}},e.prototype.purchase=function(e,t,n,r){if(!this.pauseSDK){this.validateEventName(e);var i=this.eventFactory.getPurchaseEvent(e,t,n,r,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(i),this.sendQueuedEvents(),this.qaLogging.purchaseEvent(i)}},e.prototype.iap=function(e,t,n,r,i){if(!this.pauseSDK){var s=this.eventFactory.getInAppPurchaseEventWithoutReceipt(e,t,n,r,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime(),i);this.queueEvent(s),this.sendQueuedEvents(),this.qaLogging.inAppPurchaseEventWithoutReceipt(s)}},e.prototype.currencyGiven=function(e,t){if(!this.pauseSDK){var n=this.eventFactory.getCurrencyGivenEvent(e,t,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(n),this.qaLogging.currencyGivenEvent(n)}},e.prototype.sendQueuedEvents=function(e,t){var n=this;void 0===e&&(e=this.profileManager.currentUser.userId),void 0===t&&(t=!1),_.default.info("SWRVE INTERNAL: SEND QUEUED EVENTS"),this.pauseSDK||this.evtManager.sendQueue(e).then((function(){t&&n.updateCampaignsAndResources(t)}))},e.prototype.getQueuedEvents=function(){return this.evtManager.getAllQueuedEvents(this.profileManager.userId)},e.prototype.notificationEngagedEvent=function(e){var t="Swrve.Messages.Push-".concat(e,".engaged"),n=this.eventFactory.getNamedEvent(t,{},this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(n),this.qaLogging.namedEvent(n)},e.prototype.notificationDeliveredEvent=function(e){var t="Swrve.Messages.Push-".concat(e,".delivered"),n=this.eventFactory.getNamedEvent(t,{},this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(n),this.qaLogging.namedEvent(n)},e.prototype.enqueuePushEvents=function(e){var t=this;e.forEach((function(e){var n=t.eventFactory.getNamedEvent(e.event,{},t.profileManager.getNextSequenceNumber(),e.timestamp);t.queueEvent(n),t.qaLogging.namedEvent(n)}))},e.prototype.embeddedMessageWasShownToUser=function(e){this.campaignManager.updateCampaignState(e),this.queueMessageImpressionEvent(e,{embedded:"true"})},e.prototype.embeddedMessageButtonWasPressed=function(e,t){var n=this.profileManager.getNextSequenceNumber(),r=this.eventFactory.getButtonClickEvent(n,e,t,"true");this.queueEvent(r),this.qaLogging.namedEvent(r)},e.prototype.getPersonalizedEmbeddedMessageData=function(e,t){if(null!=e)try{return"json"==e.type?M.TextTemplating.applyTextTemplatingToJSON(e.data,t):M.TextTemplating.applyTextTemplatingToString(e.data,t)}catch(e){_.default.error("Campaign id:%s Could not resolve, error with personalization",e)}return null},e.prototype.getPersonalizedText=function(e,t){if(null!=e)try{return M.TextTemplating.applyTextTemplatingToString(e,t)}catch(e){_.default.error("Could not resolve, error with personalization",e)}return null},e.prototype.stop=function(){this.pauseSDK=!0,clearInterval(this.eventLoopTimer),this.eventLoopTimer=0},e.prototype.updateCampaignsAndResources=function(e){return void 0===e&&(e=!1),o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return _.default.info("updateCampaignsAndResources"),[2,this.getCampaignsAndResources().then((function(e){t.handleCampaignResponse(e),t.isCampaignCallPending()&&t.cleanUpCampaignCallPending()})).catch((function(n){if(_.default.warn("getCampaigns failed ",n),t.isCampaignCallPending()||(t.campaignNetworkMonitorHandle=t.platform.monitorNetwork((function(e){e===h.NETWORK_CONNECTED&&(_.default.info("NETWORK RECONNECTED - RETRY CAMPAIGNS AND RESOURCES"),t.platform.stopMonitoringNetwork(t.campaignNetworkMonitorHandle),t.updateCampaignsAndResources())}))),t.storageManager.saveData(f.CAMPAIGN_CALL_PENDING,t.profileManager.currentUser.userId),e){var r=t.profileManager.currentUser.userId;t.realTimeUserPropertiesManager.loadStoredUserProperties(r),t.campaignManager.loadStoredCampaigns(r),t.resourceManager.getResources(r).then((function(e){null!=t.onResourcesLoadedCallback&&t.onResourcesLoadedCallback(e||[])})),t.autoShowMessages()}}))]}))}))},e.prototype.getRealTimeUserProperties=function(){return this.realTimeUserPropertiesManager.UserProperties},e.prototype.saveToStorage=function(){this.evtManager.saveEventsToStorage(this.profileManager.currentUser.userId)},e.prototype.identify=function(e,t,n){this.identifiedOnlyTracking||this.sendQueuedEvents(),this.pauseSDK=!0;var r=this.profileManager.currentUser.userId;if(""===e||null==e){if(this.identifiedOnlyTracking){var i="ExternalUserId must be set in config for non-anonymous tracking";throw n(i),new Error(i)}return this.createAnonymousUser(),void this.startNewSession()}var s=this.profileManager.getSwrveIdByExternalUserID(e);if(s)this.pauseSDK=!1,s!==this.profileManager.currentUser.userId?this.switchUser(s,e):this.profileManager.setExternalUserId(e),t("User Id already cached and loaded.",s);else{!this.profileManager.isUserIdVerified(this.profileManager.currentUser.userId)&&this.profileManager.currentUser.isAnonymous||this.createAnonymousUser();var o=this.profileManager.currentUser.userId;this.makeIdentityCall(e,r,o,t,n)}},e.prototype.queueMessageImpressionEvent=function(e,t){var n=this.profileManager.getNextSequenceNumber();t||(t={embedded:"false"});var r=this.eventFactory.getImpressionEvent(e,n,t);this.queueEvent(r),this.qaLogging.namedEvent(r)},e.prototype.onResourcesLoaded=function(e){"function"==typeof e?this.onResourcesLoadedCallback=e:_.default.error(f.INVALID_FUNCTION.replace("$","onResourcesLoaded"))},e.prototype.onCampaignLoaded=function(e){"function"==typeof e?this.onCampaignLoadedCallback=e:_.default.error(f.INVALID_FUNCTION.replace("$","onCampaignLoaded"))},e.prototype.getResources=function(e){var t=this;"function"==typeof e?this.resourceManager.getResources(this.profileManager.currentUser.userId).then((function(n){n?(_.default.info("RESOURCES READILY AVAILABLE"),e(n)):(_.default.info("RESOURCES NEED TO BE RETRIEVED"),t.profileManager.clearEtagHeader(),t.getCampaignsAndResources().then((function(n){t.handleCampaignResponse(n),e&&e(t.resourceManager.getResourceManager().getResources()||[])})).catch((function(t){_.default.warn("getCampaigns failed ",t),e&&e([])})))})):_.default.error(f.INVALID_FUNCTION.replace("$","getResources"))},e.prototype.getResourceManager=function(){return this.resourceManager.getResourceManager()},e.prototype.getUserResourcesDiff=function(e){var t=this;if("function"==typeof e){var n="resourcesDiff"+this.profileManager.currentUser.userId;this.getUserResourcesDiffInternal().then((function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){return[2,this.storageManager.saveDataWithMD5Hash(n,JSON.stringify(e.data)).then((function(){return e.data}))]}))}))})).catch((function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){return _.default.warn("getUserResourcesDiff failed",e),[2,this.storageManager.getDataWithMD5Hash(n).then((function(e){return e?JSON.parse(e):[]}))]}))}))})).then((function(n){var r=t.transformResourcesDiff(n);e&&e(r[0],r[1],n)}))}else _.default.error(f.INVALID_FUNCTION.replace("$","getResources"))},e.prototype.showMessageCenterCampaign=function(e,t){var n=this,r=this.retrievePersonalizationProperties({},t);return this.campaignManager.showCampaign(e,r,(function(e){return n.queueMessageImpressionEvent(e)}))},e.prototype.markMessageCenterCampaignAsSeen=function(e){this.campaignManager.markCampaignAsSeen(e)},e.prototype.removeMessageCenterCampaign=function(e){this.campaignManager.removeMessageCenterCampaign(e)},e.prototype.shutdown=function(){this._shutdown=!0,this.evtManager.saveEventsToStorage(this.profileManager.currentUser.userId),clearTimeout(this.eventLoopTimer),this.profileManager.clearEtagHeader()},e.prototype.handleSendingQueue=function(){this.sendQueuedEvents()},e.prototype.isCampaignCallPending=function(){return Boolean(this.storageManager.getData(f.CAMPAIGN_CALL_PENDING))},e.prototype.checkTriggers=function(e,t){var n=this,r=this.profileManager.isQAUser(),i=this.retrievePersonalizationProperties(t),s=this.campaignManager.checkTriggers(e,t,(function(e){return n.queueMessageImpressionEvent(e)}),r,i),o=s.globalStatus,a=s.campaignStatus,u=s.campaigns;if(r&&o.status!==f.CAMPAIGN_MATCH){_.default.debug(o.message);var c=this.eventFactory.getCampaignTriggeredEvent(e,t,o.message,"false"),l=this.profileManager.getNextSequenceNumber();this.qaLogging.campaignTriggeredEvent(l,c)}if(r&&a){_.default.debug(a.message);var p=a.status===f.CAMPAIGN_MATCH?"true":"false",h=this.eventFactory.getCampaignTriggeredEvent(e,t,a.message,p,u);l=this.profileManager.getNextSequenceNumber(),this.qaLogging.campaignTriggeredEvent(l,h)}},e.prototype.makeIdentityCall=function(e,t,n,r,i){var s=this;this.identifiedOnAnotherDevice=!1,this.identifyUser(e,n).then((function(e){return e.data})).then((function(n){s.profileManager.cacheExternalUserID(e,n.swrve_id),n.status===f.NEW_EXTERNAL_ID||n.status===f.EXISTING_EXTERNAL_ID_MATCHES_SWRVE_ID?(s.pauseSDK=!1,t!==n.swrve_id&&s.switchUser(n.swrve_id,e)):n.status===f.EXISTING_EXTERNAL_ID&&(s.identifiedOnAnotherDevice=!0,s.switchUser(n.swrve_id,e)),s.profileManager.setUserIdAsVerified(s.profileManager.currentUser.userId),s.profileManager.setExternalUserId(e),r(n.status,n.swrve_id)})).catch((function(e){s.identifiedOnlyTracking||(s.pauseSDK=!1),i&&i(e)}))},e.prototype.cleanUpCampaignCallPending=function(){void 0!==this.campaignNetworkMonitorHandle&&(this.platform.stopMonitoringNetwork(this.campaignNetworkMonitorHandle),delete this.campaignNetworkMonitorHandle),this.storageManager.clearData(f.CAMPAIGN_CALL_PENDING)},e.prototype.cleanUpIdentifyCallPending=function(){void 0!==this.identifyNetworkMonitorHandle&&(this.platform.stopMonitoringNetwork(this.identifyNetworkMonitorHandle),delete this.identifyNetworkMonitorHandle);var e=this.storageManager.getData(f.IDENTIFY_CALL_PENDING);e&&this.sendQueuedEvents(e),this.storageManager.clearData(f.IDENTIFY_CALL_PENDING),this.storageManager.clearData(f.IDENTIFY_CALL_PENDING_EXTERNAL_ID)},e.prototype.createAnonymousUser=function(){this.profileManager.setCurrentUserAsNewAnonymousUser(),this.campaignManager.resetCampaignState()},e.prototype.switchUser=function(e,t){this.profileManager.setCurrentUser(e,!1,t),this.profileManager.setUserIdAsVerified(e),this.realTimeUserPropertiesManager.loadStoredUserProperties(e),this.campaignManager.loadStoredCampaigns(e),this.startNewSession()},e.prototype.startNewSession=function(){_.default.info("Start new session"),this.pauseSDK=!1,this.autoShowEnabled=!0,this.identifiedOnlyTracking||this.initSDK(),this.queueDeviceProperties(),0===this.eventLoopTimer&&this.updateTimer(this.flushFrequency)},e.prototype.handleButtonClicked=function(e,t){var n=String(e.type.value),r=String(e.action.value);this.queueEvent(this.eventFactory.getButtonClickEvent(this.profileManager.getNextSequenceNumber(),t,e.name,"false")),this.qaLogging.buttonClickEvent(t.parentCampaign,t.id,e.name,n,r||"No action",this.profileManager.getNextSequenceNumber()),n===f.DISMISS&&this.onDismissButtonCallback?this.onDismissButtonCallback():n===f.CUSTOM&&(r.match(/^https?:\/\//)&&this.platform.openLink(r),this.onCustomButtonClickedCallback&&this.onCustomButtonClickedCallback(r))},e.prototype.autoShowMessages=function(){_.default.debug("AUTO SHOW MESSAGES "+this.autoShowEnabled),this.autoShowEnabled&&(this.checkTriggers(f.SWRVE_AUTOSHOW_AT_SESSION_START_TRIGGER,{}),this.autoShowEnabled=!1)},e.prototype.queueStartSessionEvent=function(){var e=this.eventFactory.getStartSessionEvent(this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(e),this.qaLogging.sessionStart(e)},e.prototype.getCampaignsAndResources=function(){return o(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return e=this.getQueryString(this.profileManager.currentUser.etag),t="".concat(this.config.ContentUrl,"/api/1/user_content?").concat(e),[4,this.restClient.get(t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getUserResourcesDiffInternal=function(){return o(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return e=this.getQueryString(),t="".concat(this.config.ContentUrl,"/api/1/user_resources_diff?").concat(e),[4,this.restClient.get(t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getQueryString=function(e){var t=encodeURIComponent,n=this.getContentRequestParams();return Object.keys(n).filter((function(e){return null!=n[e]})).map((function(e){return t(e)+"="+t(n[e])})).join("&")+(e?"&etag="+e:"")+"&session_token="+this.profileManager.getSessionToken()},e.prototype.getContentRequestParams=function(){return{api_key:this.config.ApiKey,user:this.profileManager.currentUser.userId,app_version:this.config.AppVersion,joined:this.profileManager.currentUser.firstUse.toString(),version:b.SWRVE_USER_CONTENT_API_VERSION,embedded_campaign_version:b.SWRVE_EMBEDDED_CAMPAIGN_VERSION,in_app_version:b.SWRVE_IN_APP_CAMPAIGN_VERSION,language:this.platform.language,app_store:this.platform.appStore,device_width:this.platform.screenWidth.toString(),device_height:this.platform.screenHeight.toString(),device_dpi:this.platform.screenDPI.toString(),device_name:this.platform.deviceName,device_type:this.platform.deviceType,os:this.platform.os,os_version:this.platform.osVersion,orientation:"landscape"}},e.prototype.retrievePersonalizationProperties=function(e,t){var n=m.RealTimeUserPropertiesManager.processForPersonalization(this.getRealTimeUserProperties()),r={};if(t&&0!=Object.keys(t).length||!this.config.PersonalizationProvider)r=t?(0,A.combineDictionaries)(n,t):n;else{var i=this.config.PersonalizationProvider(e||{});r=(0,A.combineDictionaries)(n,i)}return r},e.prototype.handleCampaignResponse=function(e){this.handleRealTimeUserProperties(e.data),this.handleCampaigns(e.data),this.handleResources(e.data),this.handleWebPushApi(e.data),null!=e.etag&&this.profileManager.storeEtagHeader(e.etag)},e.prototype.sendCampaignsDownloadedEvent=function(){var e=this.campaignManager.getCampaignIDs();if(e.length>0){var t=this.profileManager.getNextSequenceNumber();this.qaLogging.campaignsDownloadedEvent(t,e)}},e.prototype.initSDK=function(){_.default.debug("Identified-only tracking: "+this.identifiedOnlyTracking+" isAnonymous: "+this.profileManager.currentUser.isAnonymous),this.identifiedOnlyTracking&&0!=this.profileManager.currentUser.isAnonymous?_.default.debug("could not init SDK. user not identified."):(this.autoShowEnabled=!1,this.profileManager.hasSessionRestored()||(_.default.debug("Setting autoShowBack to true"),this.queueStartSessionEvent(),this.checkFirstUserInitiated(),this.autoShowEnabled=!0),this.disableAutoShowAfterDelay(),this.sendQueuedEvents(this.profileManager.currentUser.userId,!0),_.default.info("Swrve Config: ",this.config.getReadonlyVersion()),this.onSwrveCoreReadyCallback&&this.onSwrveCoreReadyCallback())},e.prototype.disableAutoShowAfterDelay=function(){var e=this;setTimeout((function(){_.default.debug("AUTO SHOW TIMED OUT "+e.config.InAppMessageConfig.autoShowMessagesMaxDelay),e.autoShowEnabled=!1}),this.config.InAppMessageConfig.autoShowMessagesMaxDelay)},e.prototype.queueEvent=function(e){this.evtManager.queueEvent(e),this.evtManager.queueSize>this.evtManager.MAX_QUEUE_SIZE&&this.handleSendingQueue()},e.prototype.handleResources=function(e){var t=this;if(e.user_resources){this.resourceManager.storeResources(e.user_resources,this.profileManager.currentUser.userId);var n=this.resourceManager.getResourceManager().getResources();null!=this.onResourcesLoadedCallback&&this.onResourcesLoadedCallback(n||[])}else this.resourceManager.getResources(this.profileManager.currentUser.userId).then((function(e){null!=t.onResourcesLoadedCallback&&t.onResourcesLoadedCallback(e||[])}))},e.prototype.handleCampaigns=function(e){var t=this;if(e&&0!==Object.keys(e).length){var n=this.retrievePersonalizationProperties();this.campaignManager.storeCampaigns(e,n,(function(){_.default.debug("ON ASSETS LOADED"),t.autoShowMessages()})),this.handleQAUser(e),this.handleFlushRefresh(e),this.onCampaignLoadedCallback&&this.onCampaignLoadedCallback(),this.sendCampaignsDownloadedEvent()}},e.prototype.handleRealTimeUserProperties=function(e){this.realTimeUserPropertiesManager.storeUserProperties(e)},e.prototype.handleUpdate=function(){this.evtManager.getQueue().length>0&&this.handleSendingQueue()},e.prototype.identifyUser=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return n=this.config.IdentityUrl,r={api_key:this.config.ApiKey,swrve_id:t,external_user_id:e,unique_device_id:this.platform.deviceID},[4,this.restClient.post(n,r)];case 1:return[2,i.sent()]}}))}))},e.prototype.handleQAUser=function(e){e.qa?(this.profileManager.setAsQAUser(e.qa),this.qaLogging.startQALogTimer()):(this.profileManager.clearQAUser(),this.qaLogging.stopQALogTimer())},e.prototype.handleWebPushApi=function(e){e.web_push_public_key&&this.webPushApiKey!==e.web_push_public_key&&(this.webPushApiKey=e.web_push_public_key,this.config.WebPushConfig.webApiKeyCallback(this.webPushApiKey,this.config.WebPushConfig.autoPushSubscribe))},e.prototype.handleFlushRefresh=function(e){var t=e.flush_frequency||3e4;this.updateTimer(t)},e.prototype.updateTimer=function(e){var t=this;0===this.eventLoopTimer?(this.flushFrequency=e,this.eventLoopTimer=setInterval((function(){return t.handleUpdate()}),e)):this.flushFrequency!==e&&(this.flushFrequency=e,0!==this.eventLoopTimer&&clearInterval(this.eventLoopTimer),this.eventLoopTimer=setInterval((function(){return t.handleUpdate()}),e))},e.prototype.validateEventName=function(e){if(null==e||""===e.trim())throw new Error(f.EMPTY_EVENT_NAME);if(/[Ss]wrve/.exec(e))throw new Error(f.INVALID_EVENT_NAME)},e.prototype.checkFirstUserInitiated=function(){var e=this.profileManager.currentUser;if((e&&0===e.firstUse||void 0===e.firstUse)&&(_.default.debug("First session on device detected. logging..."),e.firstUse=T.default.nowInUtcTime(),!1===this.identifiedOnAnotherDevice)){var t=this.eventFactory.getFirstInstallEvent(e.firstUse,this.profileManager.getNextSequenceNumber());this.queueEvent(t),this.qaLogging.namedEvent(t)}},e.prototype.loadInstallDate=function(){var e=this.storageManager.getData("firstInstallDate");null!=e&&""!==e&&(this.installDate=e),this.installDate.length<1&&(this.installDate=(0,S.getInstallDateFormat)(T.default.nowInUtcTime()),this.storageManager.saveData("firstInstallDate",String(this.installDate)))},e.prototype.queueDeviceProperties=function(){var e=(0,E.queryDeviceProperties)(this.platform,this.installDate),t=this.eventFactory.getDeviceUpdate(e,this.profileManager.getNextSequenceNumber(),T.default.nowInUtcTime());this.queueEvent(t),this.qaLogging.deviceUpdate(t),_.default.info("Swrve Device Properties: ",e)},e.prototype.transformResourcesDiff=function(e){var t={},n={};return e.forEach((function(e){var r={},i={};for(var s in e.diff)e.diff.hasOwnProperty(s)&&(r[s]=e.diff[s].old,i[s]=e.diff[s].new);t[e.uid]=r,n[e.uid]=i})),[t,n]},e.prototype.pageStateHandler=function(){this.profileManager.saveCurrentUserBeforeSessionEnd()},e}();t.Swrve=N},964:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveCoreSDK=void 0;var r=n(14),i=n(860),s=null,o=function(){function e(e,t){s=new r.Swrve(e,t)}return e.createInstance=function(t,n){return e._instance||(e._instance=new e(t,n)),e._instance},e.prototype.init=function(t){e.checkInstance().init(t)},e.checkInstance=function(){if(null==s)throw Error(i.GET_INSTANCE_ERROR);return s},e.identify=function(t,n,r){e.checkInstance().identify(t,n,r)},e.start=function(e){throw"This method has not been implemented yet"},e.started=function(){throw"This method has not been implemented yet"},e.stopTracking=function(){e.checkInstance().stop()},e.saveToStorage=function(){e.checkInstance().saveToStorage()},e.shutdown=function(){e.checkInstance().shutdown(),s=null,e._instance=null},e.onResourcesLoaded=function(t){e.checkInstance().onResourcesLoaded(t)},e.onCampaignLoaded=function(t){e.checkInstance().onCampaignLoaded(t)},e.getConfig=function(){return e.checkInstance().getConfig()},e.getPlatform=function(){return e.checkInstance().getPlatform()},e.getInstance=function(){if(null==e._instance)throw new Error(i.GET_INSTANCE_ERROR);return e._instance},e.getUserInfo=function(){return e.checkInstance().getUserInfo()},e.getUserId=function(){return e.checkInstance().getUserId()},e.getExternalUserId=function(){return e.checkInstance().getExternalUserId()},e.getSDKVersion=function(){return e.checkInstance().getSDKVersion()},e.event=function(t,n){void 0===n&&(n={}),e.checkInstance().event(t,n)},e.deviceUpdate=function(t){e.checkInstance().deviceUpdate(t)},e.userUpdate=function(t){e.checkInstance().userUpdate(t)},e.userUpdateWithDate=function(t,n){e.checkInstance().userUpdateWithDate(t,n)},e.purchase=function(t,n,r,i){e.checkInstance().purchase(t,n,r,i)},e.iap=function(t,n,r,i,s){e.checkInstance().iap(t,n,r,i,s)},e.currencyGiven=function(t,n){e.checkInstance().currencyGiven(t,n)},e.sendQueuedEvents=function(){e.checkInstance().sendQueuedEvents()},e.getQueuedEvents=function(){return e.checkInstance().getQueuedEvents()},e.getResourceManager=function(){return e.checkInstance().getResourceManager()},e.getUserResources=function(t){e.checkInstance().getResources(t)},e.getUserResourcesDiff=function(t){e.checkInstance().getUserResourcesDiff(t)},e.getRealTimeUserProperties=function(){return e.checkInstance().getRealTimeUserProperties()},e.embeddedMessageWasShownToUser=function(t){e.checkInstance().embeddedMessageWasShownToUser(t)},e.embeddedMessageButtonWasPressed=function(t,n){e.checkInstance().embeddedMessageButtonWasPressed(t,n)},e.getPersonalizedEmbeddedMessageData=function(t,n){return e.checkInstance().getPersonalizedEmbeddedMessageData(t,n)},e.getPersonalizedText=function(t,n){return e.checkInstance().getPersonalizedText(t,n)},e.getMessageCenterCampaigns=function(t){return e.checkInstance().getMessageCenterCampaigns(t)},e.showMessageCenterCampaign=function(t,n){return e.checkInstance().showMessageCenterCampaign(t,n)},e.markMessageCenterCampaignAsSeen=function(t){e.checkInstance().markMessageCenterCampaignAsSeen(t)},e.removeMessageCenterCampaign=function(t){e.checkInstance().removeMessageCenterCampaign(t)},e.getWebPushApiKey=function(){return e.checkInstance().getWebPushApiKey()},e.notificationDeliveredEvent=function(t){e.checkInstance().notificationDeliveredEvent(t)},e.notificationEngagedEvent=function(t){e.checkInstance().notificationEngagedEvent(t)},e.enqueuePushEvents=function(t){e.checkInstance().enqueuePushEvents(t)},e._instance=null,e}();t.SwrveCoreSDK=o},86:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RealTimeUserPropertiesManager=void 0;var r=n(860),i=function(){function e(e,t){this._realTimeUserProperties={},this._profileManager=e,this._storageManager=t,this.loadStoredUserProperties()}return Object.defineProperty(e.prototype,"UserProperties",{get:function(){return this._realTimeUserProperties},enumerable:!1,configurable:!0}),e.prototype.storeUserProperties=function(e,t){void 0===t&&(t=this._profileManager.currentUser.userId),e&&e.real_time_user_properties&&(this._realTimeUserProperties=e.real_time_user_properties,this._storageManager.saveData("".concat(r.REAL_TIME_USER_PROPERTIES).concat(t),JSON.stringify(this._realTimeUserProperties)))},e.prototype.loadStoredUserProperties=function(e){void 0===e&&(e=this._profileManager.currentUser.userId),this._realTimeUserProperties={};var t=this._storageManager.getData("".concat(r.REAL_TIME_USER_PROPERTIES).concat(e));t&&(this._realTimeUserProperties=JSON.parse(t))},e.processForPersonalization=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t["user."+i]=e[i]}return t},e}();t.RealTimeUserPropertiesManager=i},465:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_DISCONNECTED=t.NETWORK_CONNECTED=t.SwrveFocusManager=t.generateUuid=t.SwrveResource=t.ResourceManager=t.SwrveCoreSDK=void 0;var i=n(964);Object.defineProperty(t,"SwrveCoreSDK",{enumerable:!0,get:function(){return i.SwrveCoreSDK}});var s=n(70);Object.defineProperty(t,"NETWORK_CONNECTED",{enumerable:!0,get:function(){return s.NETWORK_CONNECTED}}),Object.defineProperty(t,"NETWORK_DISCONNECTED",{enumerable:!0,get:function(){return s.NETWORK_DISCONNECTED}});var o=n(299);Object.defineProperty(t,"ResourceManager",{enumerable:!0,get:function(){return o.ResourceManager}});var a=n(378);Object.defineProperty(t,"generateUuid",{enumerable:!0,get:function(){return a.generateUuid}});var u=n(840);Object.defineProperty(t,"SwrveResource",{enumerable:!0,get:function(){return u.SwrveResource}});var c=r(n(327));t.SwrveFocusManager=c.default},70:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_CONNECTED=t.NETWORK_DISCONNECTED=void 0,t.NETWORK_DISCONNECTED=0,t.NETWORK_CONNECTED=1},412:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSessionToken=void 0;var r=n(57);t.getSessionToken=function(e,t,n,i){var s=Math.round(i.getTime()/1e3);return t+"="+e+"="+s+"="+(0,r.md5Sync)(e+s+n)}},756:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.dateToSwrveISOString=function(e){return"".concat(e.toISOString().split(".")[0],"Z")},e.dateToSwrveYYYYMMDDFormat=function(e){return e.toISOString().split("T")[0].replace(/-/g,"")},e.dateToUTCDate=function(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))},e.nowInUtcTime=function(){return e.dateToUTCDate(new Date).getTime()},e}();t.default=n},899:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.queryDeviceProperties=void 0;var i=n(860);t.queryDeviceProperties=function(e,t){var n;return r(r({},e.getDeviceProperties()),((n={})[i.SWRVE_INSTALL_DATE]=t,n))}},30:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.combineDictionaries=void 0,t.combineDictionaries=function(e,t){var n={};if(e&&Object.keys(e).length>0){n=e;for(var r=0,i=Object.keys(t);r<i.length;r++){var s=i[r];n[s]=t[s]}}else n=t;return n}},560:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(964),i=function(){function e(){}return e.getPlatform=function(){return void 0!==e.platform||(e.platform=r.SwrveCoreSDK.getPlatform()),e.platform},e}();t.default=i},133:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStringSize=void 0,t.getStringSize=function(e){var t,n,r,i=e.length,s=0;for(r=0;r<i;r++)(t=e.charCodeAt(r))>=55296&&t<57344&&t<56320&&r+1<i&&(n=e.charCodeAt(r+1))>=56320&&n<57344?(s+=4,r++):s+=t<128?1:t<2048?2:3;return s}},860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CAMPAIGN_CALL_PENDING=t.IDENTIFY_CALL_PENDING_EXTERNAL_ID=t.IDENTIFY_CALL_PENDING=t.NEW_EXTERNAL_ID=t.EXISTING_EXTERNAL_ID=t.EXISTING_EXTERNAL_ID_MATCHES_SWRVE_ID=t.REAL_TIME_USER_PROPERTIES=t.CAMPAIGNS=t.CAMPAIGN_STATE=t.CAMPAIGN_COULD_NOT_PERSONALIZE=t.CAMPAIGN_ELIGIBLE_BUT_OTHER_CHOSEN=t.CAMPAIGN_NOT_DOWNLOADED=t.CAMPAIGN_MATCH=t.CAMPAIGN_NO_MATCH=t.CAMPAIGN_ERROR_INVALID_TRIGGERS=t.CAMPAIGN_NOT_ACTIVE=t.CAMPAIGN_THROTTLE_LAUNCH_TIME=t.CAMPAIGN_THROTTLE_MAX_IMPRESSIONS=t.CAMPAIGN_THROTTLE_RECENT=t.GLOBAL_CAMPAIGN_THROTTLE_LAUNCH_TIME=t.GLOBAL_CAMPAIGN_THROTTLE_RECENT=t.GLOBAL_CAMPAIGN_THROTTLE_MAX_IMPRESSIONS=t.CUSTOM=t.DISMISS=t.SWRVE_DEVICE_TYPE=t.SWRVE_AUTOSHOW_AT_SESSION_START_TRIGGER=t.SWRVE_CAMPAIGN_STATUS_DELETED=t.SWRVE_CAMPAIGN_STATUS_SEEN=t.SWRVE_CAMPAIGN_STATUS_UNSEEN=t.SWRVE_USER_ID_NO_PREFIX=t.SWRVE_USER_ID=t.SWRVE_DEVICE_ID=t.SWRVE_COUNTRY_CODE=t.SWRVE_DEVICE_REGION=t.SWRVE_INSTALL_DATE=t.SWRVE_APP_STORE=t.SWRVE_SDK_VERSION=t.SWRVE_TIMEZONE_NAME=t.SWRVE_UTC_OFFSET_SECONDS=t.SWRVE_LANGUAGE=t.SWRVE_DEVICE_DPI=t.SWRVE_DEVICE_HEIGHT=t.SWRVE_DEVICE_WIDTH=t.SWRVE_OS_VERSION=t.SWRVE_OS=t.SWRVE_DEVICE_NAME=t.SWRVE_IN_APP_CAMPAIGN_VERSION=t.SWRVE_EMBEDDED_CAMPAIGN_VERSION=t.SWRVE_USER_CONTENT_API_VERSION=t.SWRVE_EVENTS_API_VERSION=void 0,t.REQUIRED_DEPENDENCY_PLATFORM=t.NO_SYNCHRONOUS_STORAGE=t.EMPTY_EVENT_NAME=t.INVALID_EVENT_NAME=t.GET_INSTANCE_ERROR=t.INVALID_FUNCTION=t.APP_ID_ERROR=t.WEB_PLATFORM=void 0,t.SWRVE_EVENTS_API_VERSION=3,t.SWRVE_USER_CONTENT_API_VERSION="8",t.SWRVE_EMBEDDED_CAMPAIGN_VERSION="1",t.SWRVE_IN_APP_CAMPAIGN_VERSION="3",t.SWRVE_DEVICE_NAME="swrve.device_name",t.SWRVE_OS="swrve.os",t.SWRVE_OS_VERSION="swrve.os_version",t.SWRVE_DEVICE_WIDTH="swrve.device_width",t.SWRVE_DEVICE_HEIGHT="swrve.device_height",t.SWRVE_DEVICE_DPI="swrve.device_dpi",t.SWRVE_LANGUAGE="swrve.language",t.SWRVE_UTC_OFFSET_SECONDS="swrve.utc_offset_seconds",t.SWRVE_TIMEZONE_NAME="swrve.timezone_name",t.SWRVE_SDK_VERSION="swrve.sdk_version",t.SWRVE_APP_STORE="swrve.app_store",t.SWRVE_INSTALL_DATE="swrve.install_date",t.SWRVE_DEVICE_REGION="swrve.device_region",t.SWRVE_COUNTRY_CODE="swrve.country_code",t.SWRVE_DEVICE_ID="swrve.device_id",t.SWRVE_USER_ID="swrve.user_id",t.SWRVE_USER_ID_NO_PREFIX="user_id",t.SWRVE_CAMPAIGN_STATUS_UNSEEN="unseen",t.SWRVE_CAMPAIGN_STATUS_SEEN="seen",t.SWRVE_CAMPAIGN_STATUS_DELETED="deleted",t.SWRVE_AUTOSHOW_AT_SESSION_START_TRIGGER="Swrve.Messages.showAtSessionStart",t.SWRVE_DEVICE_TYPE="swrve.device_type",t.DISMISS="DISMISS",t.CUSTOM="CUSTOM",t.GLOBAL_CAMPAIGN_THROTTLE_MAX_IMPRESSIONS=11,t.GLOBAL_CAMPAIGN_THROTTLE_RECENT=12,t.GLOBAL_CAMPAIGN_THROTTLE_LAUNCH_TIME=13,t.CAMPAIGN_THROTTLE_RECENT=0,t.CAMPAIGN_THROTTLE_MAX_IMPRESSIONS=1,t.CAMPAIGN_THROTTLE_LAUNCH_TIME=2,t.CAMPAIGN_NOT_ACTIVE=4,t.CAMPAIGN_ERROR_INVALID_TRIGGERS=5,t.CAMPAIGN_NO_MATCH=6,t.CAMPAIGN_MATCH=7,t.CAMPAIGN_NOT_DOWNLOADED=8,t.CAMPAIGN_ELIGIBLE_BUT_OTHER_CHOSEN=10,t.CAMPAIGN_COULD_NOT_PERSONALIZE=11,t.CAMPAIGN_STATE="campaignState.",t.CAMPAIGNS="campaigns.",t.REAL_TIME_USER_PROPERTIES="real_time_user_properties.",t.EXISTING_EXTERNAL_ID_MATCHES_SWRVE_ID="existing_external_id_with_matching_swrve_id",t.EXISTING_EXTERNAL_ID="existing_external_id",t.NEW_EXTERNAL_ID="new_external_id",t.IDENTIFY_CALL_PENDING="identifyCallPending",t.IDENTIFY_CALL_PENDING_EXTERNAL_ID="identifyCallPendingExternalID",t.CAMPAIGN_CALL_PENDING="campaignCallPending",t.WEB_PLATFORM="Web",t.APP_ID_ERROR="Error creating SDK.  The appId must be greater than 0.  Your appId can be found in your Dashboard in the settings section.",t.INVALID_FUNCTION="Please pass a valid function to $.",t.GET_INSTANCE_ERROR="Please call SwrveCoreSDK.getInstance() first.",t.INVALID_EVENT_NAME="Event name may not contain the word Swrve.",t.EMPTY_EVENT_NAME="Event name may not be empty.",t.NO_SYNCHRONOUS_STORAGE="Local Storage is not available.",t.REQUIRED_DEPENDENCY_PLATFORM="IPlatform implementation is a required dependency for Swrve SDK core."},936:function(e,t){"use strict";var n=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.error=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.ERROR&&console.error.apply(console,n([t],r,!1))},e.warn=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.WARN&&console.warn.apply(console,n([t],r,!1))},e.info=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.INFO&&console.log.apply(console,n([t],r,!1))},e.debug=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.DEBUG&&console.log.apply(console,n(["DEBUG:",t],r,!1))},e.level=function(e){return void 0===e?i:i=e},e.DEBUG=20,e.INFO=30,e.WARN=40,e.ERROR=50,e.NONE=100,e}();t.default=r;var i=r.DEBUG},431:(e,t)=>{"use strict";function n(e,t){var n=document.createElement("canvas").getContext("2d");return n.font=t,n.measureText(e).width}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderedSingleLineTextWidth=t.getSingleLineTextFittedFontSize=void 0,t.getSingleLineTextFittedFontSize=function(e,t,r,i){var s=200/n(r,"".concat(200,"px ").concat(i));return Math.min(s*e,t)},t.getRenderedSingleLineTextWidth=n},151:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TextTemplating=void 0;var i=r(n(936)),s=function(){function e(){}return e.applyTextTemplatingToString=function(e,t){var n=e;if(!n||0==n.length)return n;for(;this.hasPatternMatch(n);){var r=n.match(this.patternMatch);if(null==r)throw new Error("Could not resolve personalization");var i=r[0],s=this.getFallBack(i),o=r[1];if(null!=s&&(o=o.substring(0,o.indexOf('|fallback="'))),null!=t&&null!=t[o]&&t[o].length>0)n=n.replace(i,t[o]);else{if(null==s)throw new Error("TextTemplating: Missing property value for key "+o);n=n.replace(i,s)}}return n},e.applyTextTemplatingToJSON=function(e,t){var n=e;if(!n||0==n.length)return n;for(;this.hasPatternMatch(n);){var r=n.match(this.patternMatch);if(null==r)throw new Error("Could not resolve personalization");var i=r[0],s=this.getFallBackJSON(i),o=r[1];if(null!=s&&(o=o.substring(0,o.indexOf('|fallback=\\"'))),null!=t&&null!=t[o]&&t[o].length>0)n=n.replace(i,t[o]);else{if(null==s)throw new Error("TextTemplating: Missing property value for key "+o);n=n.replace(i,s)}}return n},e.hasPatternMatch=function(e){return null!=e&&this.patternMatch.test(e)},e.getFallBack=function(t){var n=t.match(e.patternFallbackMatch);return null!=n?n[1]:null},e.getFallBackJSON=function(t){var n=t.match(e.patternJSONFallbackMatch);return null!=n?(i.default.debug("getFallbackJSON Got a Match: "+n[1]),n[1]):null},e.patternMatch=/\$\{([^\}]*)\}/i,e.patternFallbackMatch=/\|fallback=\"([^\}]*)"\}/i,e.patternJSONFallbackMatch=/\|fallback=\\"([^\}]*)\\"\}/i,e}();t.TextTemplating=s},978:(e,t)=>{"use strict";function n(e){return"number"==typeof e||"string"==typeof e?new Date(e):e}function r(e){return n(e).getTime()}function i(e){return n(e).toISOString()}Object.defineProperty(t,"__esModule",{value:!0}),t.getInstallDateFormat=t.getISOString=t.getTimestampSeconds=t.getTimestampMilliseconds=t.getDateObject=void 0,t.getDateObject=n,t.getTimestampMilliseconds=r,t.getTimestampSeconds=function(e){return Math.floor(r(e)/1e3)},t.getISOString=i,t.getInstallDateFormat=function(e){return i(e).split("T")[0].replace(/-/g,"")}},57:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.md5Async=t.md5Sync=void 0;var i,s=r(n(214)),o=r(n(923)),a=0,u={};function c(e){return(0,s.default)(e).toString()}"undefined"!=typeof window&&"Worker"in window&&((i=new o.default).onmessage=function(e){var t=e.data,n=t.id,r=t.payload,i=u[n];i&&i(r),delete u[n]}),t.md5Sync=c,t.md5Async=function(e){return i?function(e){var t=a++,n={id:t,payload:e};return new Promise((function(e,r){u[t]=e,i.postMessage(n)}))}(e):Promise.resolve(c(e))}},378:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=t.generateUuid=t.parseUuid=void 0,t.parseUuid=function(e){var t=/^\s*([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\s*$/i.exec(e);if(null==t)throw new Error("Invalid UUID");var r=(t[1]+t[2]+t[3]+t[4]+t[5]).split(/(..)/g).filter((function(e){return 2===e.length})).map((function(e){return parseInt(e,16)}));return new n(r)},t.generateUuid=function(){var e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,new n([].slice.call(e))};var n=function(){function e(e){if(16!==e.length)throw new Error("Invalid UUID: Incorrect byte count");this.bytes=e.map((function(e){return 255&e}))}return e.prototype.toString=function(){return this.bytes.map((function(e){return e.toString(16)})).map((function(e){return("0"+e).substr(-2)})).join("").replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/,"$1-$2-$3-$4-$5")},e}();t.Uuid=n},923:(e,t,n)=>{e.exports=function(){return n(855)('(()=>{var t={249:function(t,n,r){var e;t.exports=(e=e||function(t,n){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(e=globalThis.crypto),!e&&"undefined"!=typeof window&&window.msCrypto&&(e=window.msCrypto),!e&&void 0!==r.g&&r.g.crypto&&(e=r.g.crypto),!e)try{e=r(480)}catch(t){}var i=function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(n){var r;return t.prototype=n,r=new t,t.prototype=null,r}}(),s={},a=s.lib={},c=a.Base={extend:function(t){var n=o(this);return t&&n.mixIn(t),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},u=a.WordArray=c.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=null!=n?n:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var n=this.words,r=t.words,e=this.sigBytes,i=t.sigBytes;if(this.clamp(),e%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;n[e+o>>>2]|=s<<24-(e+o)%4*8}else for(var a=0;a<i;a+=4)n[e+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var n=this.words,r=this.sigBytes;n[r>>>2]&=4294967295<<32-r%4*8,n.length=t.ceil(r/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(i());return new u.init(n,t)}}),f=s.enc={},h=f.Hex={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],i=0;i<r;i++){var o=n[i>>>2]>>>24-i%4*8&255;e.push((o>>>4).toString(16)),e.push((15&o).toString(16))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e+=2)r[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new u.init(r,n/2)}},d=f.Latin1={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],i=0;i<r;i++){var o=n[i>>>2]>>>24-i%4*8&255;e.push(String.fromCharCode(o))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e++)r[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new u.init(r,n)}},l=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(d.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return d.parse(unescape(encodeURIComponent(t)))}},p=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(n){var r,e=this._data,i=e.words,o=e.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=n?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*s,f=t.min(4*c,o);if(c){for(var h=0;h<c;h+=s)this._doProcessBlock(i,h);r=i.splice(0,c),e.sigBytes-=f}return new u.init(r,f)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),y=(a.Hasher=p.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(n,r){return new t.init(r).finalize(n)}},_createHmacHelper:function(t){return function(n,r){return new y.HMAC.init(t,r).finalize(n)}}}),s.algo={});return s}(Math),e)},214:function(t,n,r){var e;t.exports=(e=r(249),function(t){var n=e,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.algo,a=[];!function(){for(var n=0;n<64;n++)a[n]=4294967296*t.abs(t.sin(n+1))|0}();var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,n){for(var r=0;r<16;r++){var e=n+r,i=t[e];t[e]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=t[n+0],c=t[n+1],l=t[n+2],p=t[n+3],y=t[n+4],g=t[n+5],v=t[n+6],w=t[n+7],_=t[n+8],m=t[n+9],B=t[n+10],x=t[n+11],b=t[n+12],S=t[n+13],H=t[n+14],M=t[n+15],z=o[0],C=o[1],D=o[2],j=o[3];z=u(z,C,D,j,s,7,a[0]),j=u(j,z,C,D,c,12,a[1]),D=u(D,j,z,C,l,17,a[2]),C=u(C,D,j,z,p,22,a[3]),z=u(z,C,D,j,y,7,a[4]),j=u(j,z,C,D,g,12,a[5]),D=u(D,j,z,C,v,17,a[6]),C=u(C,D,j,z,w,22,a[7]),z=u(z,C,D,j,_,7,a[8]),j=u(j,z,C,D,m,12,a[9]),D=u(D,j,z,C,B,17,a[10]),C=u(C,D,j,z,x,22,a[11]),z=u(z,C,D,j,b,7,a[12]),j=u(j,z,C,D,S,12,a[13]),D=u(D,j,z,C,H,17,a[14]),z=f(z,C=u(C,D,j,z,M,22,a[15]),D,j,c,5,a[16]),j=f(j,z,C,D,v,9,a[17]),D=f(D,j,z,C,x,14,a[18]),C=f(C,D,j,z,s,20,a[19]),z=f(z,C,D,j,g,5,a[20]),j=f(j,z,C,D,B,9,a[21]),D=f(D,j,z,C,M,14,a[22]),C=f(C,D,j,z,y,20,a[23]),z=f(z,C,D,j,m,5,a[24]),j=f(j,z,C,D,H,9,a[25]),D=f(D,j,z,C,p,14,a[26]),C=f(C,D,j,z,_,20,a[27]),z=f(z,C,D,j,S,5,a[28]),j=f(j,z,C,D,l,9,a[29]),D=f(D,j,z,C,w,14,a[30]),z=h(z,C=f(C,D,j,z,b,20,a[31]),D,j,g,4,a[32]),j=h(j,z,C,D,_,11,a[33]),D=h(D,j,z,C,x,16,a[34]),C=h(C,D,j,z,H,23,a[35]),z=h(z,C,D,j,c,4,a[36]),j=h(j,z,C,D,y,11,a[37]),D=h(D,j,z,C,w,16,a[38]),C=h(C,D,j,z,B,23,a[39]),z=h(z,C,D,j,S,4,a[40]),j=h(j,z,C,D,s,11,a[41]),D=h(D,j,z,C,p,16,a[42]),C=h(C,D,j,z,v,23,a[43]),z=h(z,C,D,j,m,4,a[44]),j=h(j,z,C,D,b,11,a[45]),D=h(D,j,z,C,M,16,a[46]),z=d(z,C=h(C,D,j,z,l,23,a[47]),D,j,s,6,a[48]),j=d(j,z,C,D,w,10,a[49]),D=d(D,j,z,C,H,15,a[50]),C=d(C,D,j,z,g,21,a[51]),z=d(z,C,D,j,b,6,a[52]),j=d(j,z,C,D,p,10,a[53]),D=d(D,j,z,C,B,15,a[54]),C=d(C,D,j,z,c,21,a[55]),z=d(z,C,D,j,_,6,a[56]),j=d(j,z,C,D,M,10,a[57]),D=d(D,j,z,C,v,15,a[58]),C=d(C,D,j,z,S,21,a[59]),z=d(z,C,D,j,y,6,a[60]),j=d(j,z,C,D,x,10,a[61]),D=d(D,j,z,C,l,15,a[62]),C=d(C,D,j,z,m,21,a[63]),o[0]=o[0]+z|0,o[1]=o[1]+C|0,o[2]=o[2]+D|0,o[3]=o[3]+j|0},_doFinalize:function(){var n=this._data,r=n.words,e=8*this._nDataBytes,i=8*n.sigBytes;r[i>>>5]|=128<<24-i%32;var o=t.floor(e/4294967296),s=e;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var f=c[u];c[u]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function u(t,n,r,e,i,o,s){var a=t+(n&r|~n&e)+i+s;return(a<<o|a>>>32-o)+n}function f(t,n,r,e,i,o,s){var a=t+(n&e|r&~e)+i+s;return(a<<o|a>>>32-o)+n}function h(t,n,r,e,i,o,s){var a=t+(n^r^e)+i+s;return(a<<o|a>>>32-o)+n}function d(t,n,r,e,i,o,s){var a=t+(r^(n|~e))+i+s;return(a<<o|a>>>32-o)+n}n.MD5=o._createHelper(c),n.HmacMD5=o._createHmacHelper(c)}(Math),e.MD5)},134:function(t,n,r){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var i=e(r(214)),o=self;o.onmessage=function(t){var n=t.data,r=n.id,e=n.payload,s=(0,i.default)(e).toString();o.postMessage({id:r,payload:s})}},480:()=>{}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,r),o.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r(134)})();',null)}},855:e=>{"use strict";var t=window.URL||window.webkitURL;e.exports=function(e,n){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(t.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!n)throw Error("Inline worker is not supported");return new Worker(n)}}},480:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(465)})(),e.exports=t()},16:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SwrveSDK=void 0;var i=r(n(849)),s=n(376),o=r(n(69)),a=r(n(913)),u=n(9),c=r(n(474)),l=function(e,t){a.default.debug("Initializing PushManager with WebPushAPIKey: ".concat(e)),h.initializePushManager(e),t?(a.default.debug("autoPushSubscribe: ON"),h.registerPush()):a.default.debug("SwrvePushManager Will not register for push. Auto subscribe is disabled")},p=null,h=function(){function e(e){p=s.SwrveCoreSDK.createInstance(e,{platform:new i.default})}return e.initWithConfig=function(t,n){return e.createInstance(t),e._instance.init(n),e._instance},e.createInstance=function(t){if(t.apiKey.toLowerCase().startsWith("secret-"))throw Error("API Key ".concat(t.apiKey," is invalid. It should not start with 'secret-'"));if(e._instance)return e._instance;var n=c.default.validateInitParams(t);if(n)throw c.default.outputErrors(n),1==n.devErrors.length?new Error(n.devErrors[0]):new Error("Multiple issues found with configuration");return this._swrvePushManager=new o.default(t),t.webPushConfig={webApiKeyCallback:l,autoPushSubscribe:t.autoPushSubscribe},this._config=t,e._instance=new e(this._config),e._instance},e.prototype.init=function(e){if(null==p)throw Error("Please call SwrveSDK.createInstance() first.");p.init(e)},e.checkCoreInstance=function(){if(null==p)throw Error("Please call SwrveSDK.createInstance() first.");return s.SwrveCoreSDK},e.getInstance=function(){if(null==e._instance)throw Error("Please call SwrveSDK.createInstance() first.");return e._instance},e.getUserInfo=function(){return e.checkCoreInstance().getUserInfo()},e.getUserId=function(){return e.checkCoreInstance().getUserId()},e.getExternalUserId=function(){return e.checkCoreInstance().getExternalUserId()},e.getConfig=function(){var t=e.checkCoreInstance().getConfig();return t.externalUserId=this._config.externalUserId,t},e.getSDKVersion=function(){return u.sdkVersion},e.getRealTimeUserProperties=function(){return e.checkCoreInstance().getRealTimeUserProperties()},e.event=function(t,n){void 0===n&&(n={}),e.checkCoreInstance().event(t,n)},e.userUpdate=function(t){e.checkCoreInstance().userUpdate(t)},e.userUpdateWithDate=function(t,n){e.checkCoreInstance().userUpdateWithDate(t,n)},e.purchase=function(t,n,r,i){e.checkCoreInstance().purchase(t,n,r,i)},e.iap=function(t,n,r,i,s){e.checkCoreInstance().iap(t,n,r,i,s)},e.currencyGiven=function(t,n){e.checkCoreInstance().currencyGiven(t,n)},e.sendQueuedEvents=function(){e.checkCoreInstance().sendQueuedEvents()},e.shutdown=function(){this._swrvePushManager&&this._swrvePushManager.shutdown(),e.checkCoreInstance().shutdown(),p=null,e._instance=null},e.stopTracking=function(){e.checkCoreInstance().stopTracking()},e.saveToStorage=function(){e.checkCoreInstance().saveToStorage()},e.getResourceManager=function(){return e.checkCoreInstance().getResourceManager()},e.onResourcesLoaded=function(t){e.checkCoreInstance().onResourcesLoaded(t)},e.getResources=function(t){e.checkCoreInstance().getUserResources(t)},e.getUserResourcesDiff=function(t){e.checkCoreInstance().getUserResourcesDiff(t)},e.embeddedMessageWasShownToUser=function(t){e.checkCoreInstance().embeddedMessageWasShownToUser(t)},e.embeddedMessageButtonWasPressed=function(t,n){e.checkCoreInstance().embeddedMessageButtonWasPressed(t,n)},e.getPersonalizedEmbeddedMessageData=function(t,n){return e.checkCoreInstance().getPersonalizedEmbeddedMessageData(t,n)},e.getPersonalizedText=function(t,n){return e.checkCoreInstance().getPersonalizedText(t,n)},e.getMessageCenterCampaigns=function(t){return e.checkCoreInstance().getMessageCenterCampaigns(t)},e.showMessageCenterCampaign=function(t,n){return e.checkCoreInstance().showMessageCenterCampaign(t,n)},e.markMessageCenterCampaignAsSeen=function(t){e.checkCoreInstance().markMessageCenterCampaignAsSeen(t)},e.removeMessageCenterCampaign=function(t){e.checkCoreInstance().removeMessageCenterCampaign(t)},e.initializePushManager=function(t){var n=e.checkCoreInstance().getUserId();this._swrvePushManager.init(t,n)},e.getPushManager=function(){return this._swrvePushManager},e.registerPush=function(t,n){e.checkCoreInstance(),this._swrvePushManager.registerPush(t,n)},e.unregisterPush=function(t,n){e.checkCoreInstance(),this._swrvePushManager.unregisterPush(t,n)},e._instance=null,e._swrvePushManager=null,e._config=null,e}();t.SwrveSDK=h},26:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultFlushRefreshDelay=t.defaultFlushFrequency=t.swrveVersion=t.swrveServiceWorkerName=t.swrveDefaultDBVersion=t.swrveDefaultDBName=t.webWorkerDbName=t.messageConfig=void 0,t.messageConfig={title:"Swrve WebSDK",types:{error:"Error",info:"Info",warn:"Warning"}},t.webWorkerDbName="SwrveWebWorkerDB",t.swrveDefaultDBName="SwrveWebSDK",t.swrveDefaultDBVersion=1,t.swrveServiceWorkerName="SwrveWorker.js",t.swrveVersion=3,t.defaultFlushFrequency=6e4,t.defaultFlushRefreshDelay=5e3},9:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.osBlackList=t.browserBlackList=t.osRegex=t.browsersRegex=t.browserList=t.SWRVE_NAV_LANGUAGE=t.SWRVE_BROWSER_VERSION=t.SWRVE_BROWSER_NAME=t.SWRVE_DEVICE_TYPE=t.SWRVE_UTC_OFFSET_SECONDS=t.SWRVE_USER_ID=t.SWRVE_TIMEZONE_NAME=t.SWRVE_SDK_VERSION=t.SWRVE_OS_VERSION=t.SWRVE_OS=t.SWRVE_LANGUAGE=t.SWRVE_INSTALL_DATE=t.SWRVE_DEVICE_DPI=t.SWRVE_DEVICE_HEIGHT=t.SWRVE_DEVICE_WIDTH=t.SWRVE_DEVICE_REGION=t.SWRVE_DEVICE_NAME=t.SWRVE_DEVICE_ID=t.SWRVE_COUNTRY_CODE=t.SWRVE_APP_STORE=t.appStore=t.sdkVersion=void 0;var r=n(147);t.sdkVersion="Web ".concat(r.version),t.appStore="web",t.SWRVE_APP_STORE="swrve.app_store",t.SWRVE_COUNTRY_CODE="swrve.country_code",t.SWRVE_DEVICE_ID="swrve.device_id",t.SWRVE_DEVICE_NAME="swrve.device_name",t.SWRVE_DEVICE_REGION="swrve.device_region",t.SWRVE_DEVICE_WIDTH="swrve.device_width",t.SWRVE_DEVICE_HEIGHT="swrve.device_height",t.SWRVE_DEVICE_DPI="swrve.device_dpi",t.SWRVE_INSTALL_DATE="swrve.install_date",t.SWRVE_LANGUAGE="swrve.language",t.SWRVE_OS="swrve.os",t.SWRVE_OS_VERSION="swrve.os_version",t.SWRVE_SDK_VERSION="swrve.sdk_version",t.SWRVE_TIMEZONE_NAME="swrve.timezone_name",t.SWRVE_USER_ID="swrve.user_id",t.SWRVE_UTC_OFFSET_SECONDS="swrve.utc_offset_seconds",t.SWRVE_DEVICE_TYPE="swrve.device_type",t.SWRVE_BROWSER_NAME="swrve.browser_name",t.SWRVE_BROWSER_VERSION="swrve.browser_version",t.SWRVE_NAV_LANGUAGE="language",t.browserList=["chrome","opera","safari","firefox","msIE","Unknown"],t.browsersRegex={appleWebkit:/applewebkit/,chrome:/chrome/,chromium:/chromium/,edge:/edge/,firefox:/firefox/,mozilla:/mozilla/,msIE:/msie/,opera:/opr/,safari:/safari/,seamonkey:/seamonkey/,trident:/trident/,webkit:/webkit/},t.osRegex=[{name:"Windows 10",regex:/(Windows 10.0|Windows NT 10.0)/},{name:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{name:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{name:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{name:"Windows Vista",regex:/Windows NT 6.0/},{name:"Windows Server 2003",regex:/Windows NT 5.2/},{name:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{name:"Windows 2000",regex:/(Windows NT 5.0|Windows 2000)/},{name:"Windows ME",regex:/(Win 9x 4.90|Windows ME)/},{name:"Windows 98",regex:/(Windows 98|Win98)/},{name:"Windows 95",regex:/(Windows 95|Win95|Windows_95)/},{name:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{name:"Windows CE",regex:/Windows CE/},{name:"Windows 3.11",regex:/Win16/},{name:"Android",regex:/Android/},{name:"Open BSD",regex:/OpenBSD/},{name:"Sun OS",regex:/SunOS/},{name:"Linux",regex:/(Linux|X11)/},{name:"iOS",regex:/(iPhone|iPad|iPod)/},{name:"Mac OS X",regex:/Mac OS X/},{name:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{name:"QNX",regex:/QNX/},{name:"UNIX",regex:/UNIX/},{name:"BeOS",regex:/BeOS/},{name:"OS/2",regex:/OS\/2/},{name:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|python|ruby|curl|bingbot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],t.browserBlackList=["msIE"],t.osBlackList=["Search Bot"]},771:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(913)),s=n(9),o=function(){function e(){}return e.getClientInfo=function(){var e,t=this.getOS(),n=this.getBrowserInfo();return(e={})[s.SWRVE_DEVICE_NAME]=this.getDeviceName(),e[s.SWRVE_OS]="web",e[s.SWRVE_OS_VERSION]=t.version,e[s.SWRVE_SDK_VERSION]=this.getSDKVersion(),e[s.SWRVE_LANGUAGE]=this.getBrowserLanguage(),e[s.SWRVE_COUNTRY_CODE]=this.getCountryCode(),e[s.SWRVE_DEVICE_REGION]=this.getRegion(),e[s.SWRVE_TIMEZONE_NAME]=this.getTimezoneName(),e[s.SWRVE_APP_STORE]=s.appStore,e[s.SWRVE_BROWSER_NAME]=n.name,e[s.SWRVE_BROWSER_VERSION]=n.version,e[s.SWRVE_DEVICE_TYPE]=this.getDeviceType(),e},e.getOS=function(){var e,t={},n=navigator.userAgent.match(/\((.*?)\)/);n&&n.length>=2&&(t.version=n[1]);for(var r=0,i=s.osRegex;r<i.length;r++)if((e=i[r]).regex.test(navigator.userAgent)){t.name=e.name;break}return t},e.getDeviceName=function(){return"".concat(this.getOS().name," ").concat(this.getBrowserInfo().name," ").concat(this.getBrowserInfo().version)},e.getScreenResolution=function(){return{height:window.screen.availHeight.toString()||"Unknown",width:window.screen.availWidth.toString()||"Unknown"}},e.getDocumentHeight=function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)},e.getDocumentWidth=function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)},e.getAvailableScreenHeight=function(){return"undefined"!=typeof navigator?screen.availHeight:0},e.getAvailableScreenWidth=function(){return"undefined"!=typeof navigator?screen.availWidth:0},e.getBrowserLanguage=function(){return navigator[s.SWRVE_NAV_LANGUAGE]||navigator.language.split("-")[0]||"Unknown"},e.getTimezoneName=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone||"Unknown"},e.getUTCOffsetSeconds=function(e){var t=-60*e.getTimezoneOffset();return-0===t?0:t},e.getCountryCode=function(){return new Intl.Locale(navigator.language).region||"Unknown"},e.getRegion=function(){return new Intl.Locale(navigator.language).region||"Unknown"},e.getDeviceType=function(){var e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|ios|blackberry|iemobile|opera mini|mobi/i.test(e)?"mobile":"desktop"},e.getBrowserInfo=function(){var t={name:"Unknown",version:"N/A"},n=navigator.userAgent.toLowerCase(),r=this.checkBrowser();for(var s in r)if(r[s])return t.name=s,t.version=e.extractBrowserVersion(s,n),t;return i.default.error("Cannot identify browser"),t},e.getSDKVersion=function(){return s.sdkVersion},e.extractBrowserVersion=function(e,t){var n,r=new RegExp("version/(([0-9])+(.([0-9])+)+)"),i=new RegExp("rv:(([0-9])+(.([0-9])+)+)");return"safari"===e?(n=t.match(r))?n[1]:"N/A":(n=t.match(new RegExp("(".concat("msIE"===e?"msIE|edge":e,")( |/)(([0-9])+(.([0-9])+)+)"))))?n[3]||"N/A":(n=t.match(i))?n[1]:"N/A"},e.checkBrowser=function(){var e=navigator.userAgent.toLowerCase();return{chrome:s.browsersRegex.webkit.test(e)&&s.browsersRegex.chrome.test(e)&&!s.browsersRegex.edge.test(e)&&!s.browsersRegex.chromium.test(e),firefox:s.browsersRegex.mozilla.test(e)&&s.browsersRegex.firefox.test(e)&&!s.browsersRegex.seamonkey.test(e),msIE:s.browsersRegex.msIE.test(e)||s.browsersRegex.trident.test(e)||s.browsersRegex.edge.test(e),opera:s.browsersRegex.mozilla.test(e)&&s.browsersRegex.appleWebkit.test(e)&&s.browsersRegex.chrome.test(e)&&s.browsersRegex.safari.test(e)&&s.browsersRegex.opera.test(e),safari:s.browsersRegex.safari.test(e)&&s.browsersRegex.appleWebkit.test(e)&&!s.browsersRegex.chrome.test(e)}},e}();t.default=o},474:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(26),o=i(n(913)),a=/[(https):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi,u=function(){function e(){}return e.validateExternalUserId=function(e){var t=[],n="string";return null!=e&&typeof e!==n&&t.push("externalUserId should be a ".concat(n)),t},e.validateAppId=function(e){var t=[];return e||t.push("appId doesn't exist"),e&&isNaN(e)&&t.push("appId should be a ".concat("number")),t},e.validateApiKey=function(e){var t=[];e||t.push("apiKey doesn't exist");var n="string";return e&&typeof e!==n&&t.push("apiKey should be a ".concat(n)),e&&typeof e===n&&!e.startsWith("web_sdk-")&&t.push("apiKey should be a valid web_sdk api key"),t},e.validateContentUrl=function(e){var t=[],n="string";e&&typeof e!==n&&t.push("contentURL should be a ".concat(n));var r=new RegExp(a);return e&&!r.test(e)&&t.push("contentURL isn't valid URL"),t},e.validateEventsUrl=function(e){var t=[],n="string";e&&typeof e!==n&&t.push("eventsUrl should be a ".concat(n));var r=new RegExp(a);return e&&!r.test(e)&&t.push("eventsUrl isn't a valid URL"),t},e.validateVersion=function(e){var t=[],n="string";return e&&typeof e!==n&&t.push("version should be a ".concat(n)),e&&!/(([0-9])+(\.([0-9])+)+)/.test(e)&&t.push("version isn't valid"),t},e.validateSessionTimeout=function(e){var t=[],n="number";return e&&typeof e!==n&&t.push("sessionTimeout should be a ".concat(n)),e&&e<0&&t.push("sessionTimeout should be positive integer or 0"),t},e.validateInitParams=function(e){var t={};if(e&&"[object Object]"===Object.prototype.toString.call(e)?t.devErrors=r(r(r(r(r(r(r([],this.validateExternalUserId(e.externalUserId),!0),this.validateApiKey(e.apiKey),!0),this.validateAppId(e.appId),!0),this.validateContentUrl(e.contentUrl),!0),this.validateEventsUrl(e.eventsUrl),!0),this.validateVersion(e.appVersion),!0),this.validateSessionTimeout(e.httpsTimeoutSeconds),!0):t.devErrors=["Init params should follow the scheme:\n        {\n          externalUserId: string - *required\n          appId: number - *required\n          apiKey: string - *required\n          eventsUrl: string\n          contentUrl: string\n          sessionTimeout: number\n          version: string\n        }"],t.devErrors.length)return t.mainError="Initial configuration parameters are incorrect",t},e.outputErrors=function(e){o.default.error("".concat(s.messageConfig.title," ").concat(s.messageConfig.types.error,": ").concat(e.mainError)),e.devErrors.forEach((function(e){o.default.error(" ".concat(e))}))},e}();t.default=u},849:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.calculatePPI=t.detectScreenDiagonal=void 0;var i=n(376),s=n(9),o=r(n(771));function a(e){var t,n=e.match(/\d+/);return n&&(t=parseInt(n[0],10)),t||27}function u(e,t,n){var r=Math.sqrt(e*e+t*t);return Math.round(r/n)}t.detectScreenDiagonal=a,t.calculatePPI=u;var c={36:"Return",38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",65:"A",66:"B",67:"C",68:"D",8:"Back",179:"Play",227:"FastForward",228:"Rewind",112:"F1"},l=function(){function e(){this.needsProxy=!0,this.supportsMagicWandNatively=!1,this.startHistoryLength=0,this.networkListeners=[];var e=o.default.getClientInfo();this._region=e[s.SWRVE_DEVICE_REGION],this._language=e[s.SWRVE_LANGUAGE],this._countryCode=e[s.SWRVE_COUNTRY_CODE],this._deviceName=e[s.SWRVE_DEVICE_NAME],this._deviceID=this.findOrCreateDeviceId(),this._deviceType=e[s.SWRVE_DEVICE_TYPE],this._timezone=e[s.SWRVE_TIMEZONE_NAME],this._osVersion=e[s.SWRVE_OS_VERSION]||"Unknown",this._browserVersion=e[s.SWRVE_BROWSER_VERSION],this._utcOffSetSeconds=o.default.getUTCOffsetSeconds(new Date),this._os=e[s.SWRVE_OS]||"Unknown",this._model=e[s.SWRVE_BROWSER_NAME],this._firmware="",this._screenHeight=o.default.getAvailableScreenHeight(),this._screenWidth=o.default.getAvailableScreenWidth(),this._screenDPI=u(this._screenWidth,this._screenHeight,a("replace"))||1e3,this._deviceName=o.default.getDeviceName()}return e.prototype.init=function(e){this.startHistoryLength=window.history.length;var t=document.createElement("div");return t.id="PALImageCache",t.style.overflow="hidden",t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",null===document.getElementById("PALImageCache")&&document.body.appendChild(t),Promise.resolve()},e.prototype.name=function(){return{name:"Browser",variation:"Web"}},Object.defineProperty(e.prototype,"deviceName",{get:function(){return o.default.getDeviceName()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"synchronousStorage",{get:function(){return window.localStorage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appStore",{get:function(){return"web"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firmware",{get:function(){return this._firmware||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceID",{get:function(){return this._deviceID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this._model||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"os",{get:function(){return o.default.getOS().name||"unknown"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"osVersion",{get:function(){return o.default.getOS().version||"unknown"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceType",{get:function(){return o.default.getDeviceType()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timezone",{get:function(){return this._timezone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"region",{get:function(){return this._region},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._language},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countryCode",{get:function(){return this._countryCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenDPI",{get:function(){return this._screenDPI},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenHeight",{get:function(){return this._screenHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenWidth",{get:function(){return this._screenWidth},enumerable:!1,configurable:!0}),e.prototype.getNeedsProxy=function(){return this.needsProxy},e.prototype.getSupportsMagicWandNatively=function(){return this.supportsMagicWandNatively},e.prototype.disableScreenSaver=function(){console.error("platform does not know how to disable screensaver")},e.prototype.enableScreenSaver=function(){console.error("platform does not know how to enable screensaver")},e.prototype.exit=function(e){var t=window.history.length-this.startHistoryLength-1;window.history.go(-t)},e.prototype.getDeviceBrowserVersion=function(){return o.default.getBrowserInfo().version},e.prototype.getDeviceProperties=function(){var e=o.default.getClientInfo();return e[s.SWRVE_DEVICE_ID]=this._deviceID,e},e.prototype.supportsHDR=function(){return!1},e.prototype.getKeymapping=function(){return c},e.prototype.downloadAssets=function(e){var t=e.map((function(e){var t=document.createElement("img");t.src=e.path,console.log("PAL download "+e.path);var n=document.getElementById("PALImageCache");return n?n.appendChild(t):console.log(" PAL: Image cache does not exist"),new Promise((function(e,n){t.addEventListener("load",(function(){e()})),t.addEventListener("error",(function(){n()}))}))}));return Promise.all(t).then((function(){}))},e.prototype.checkStorageForAsset=function(e){var t=document.createElement("img");t.src=e.getAssetPath().toString();var n=document.getElementById("PALImageCache");return n?n.appendChild(t):console.log("PALImage Cache does not exist"),t.complete||t.width+t.height>0},e.prototype.openLink=function(e){window.open(e)},e.prototype.monitorNetwork=function(e){return void 0===this.networkMonitorHandle&&(this.networkMonitorHandle=this.initNetworkListener()),this.networkListeners.push(e),e},e.prototype.stopMonitoringNetwork=function(e){throw new Error("Method not implemented.")},e.prototype.triggerNetworkChange=function(e){this.networkListeners.forEach((function(t){return t(e)}))},e.prototype.initNetworkListener=function(){var e=this,t=function(){return e.triggerNetworkChange(i.NETWORK_CONNECTED)},n=function(){return e.triggerNetworkChange(i.NETWORK_DISCONNECTED)};return window.addEventListener("offline",n),window.addEventListener("online",t),[t,n]},e.prototype.removeNetworkListener=function(e){var t=e,n=t[0],r=t[1];window.removeEventListener("offline",r),window.removeEventListener("online",n)},e.prototype.findOrCreateDeviceId=function(){var e=this.synchronousStorage.getItem(s.SWRVE_DEVICE_ID);return e||(e=(0,i.generateUuid)().toString(),this.synchronousStorage.setItem(s.SWRVE_DEVICE_ID,e),e)},e}();t.default=l},69:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.serviceWorkerEventTypes=void 0;var o=n(16),a=n(729),u=n(555),c=s(n(913));t.serviceWorkerEventTypes={swrvePushNotificationClicked:"swrve.push_clicked",swrvePushNotificationClosed:"swrve.push_closed",swrvePushReceived:"swrve.push_received"};var l=function(){function e(e,t,n,r){this._isInitialized=!1,this._eventFlushFreqency=3e4,this._config=e,this.callBackPushReceived=t||u.noOp,this.callBackPushClicked=n||u.noOp,this.callBackPushClosed=r||u.noOp}return Object.defineProperty(e.prototype,"IsInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"WebPushApiKey",{get:function(){return this._webPushApiKey},enumerable:!1,configurable:!0}),e.prototype.init=function(e,t){var n=this;this.IsInitialized?c.default.debug("SwrvePushManager :: Already Initialized"):this.isPushSupported()?(this._webPushApiKey=e,this._userId=t,this._isInitialized=!0,navigator.serviceWorker.getRegistration(this._config.serviceWorker).then((function(e){(0,u.isNil)(e)||(n.syncServiceWorkerThread(),n.registerPushListeners(),e.pushManager.getSubscription().then((function(e){e?n.sendPushRegistrationProperties(e):n.sendBrowserPermissions()})).catch((function(e){c.default.warn("Error sending in subscription properties.\n ".concat(e))})))})).catch((function(e){c.default.warn("Push registration not found; unable to sync with worker.\n ".concat(e))}))):c.default.debug("SwrvePushManager :: Push is not supported")},e.prototype.registerPush=function(e,t){return void 0===e&&(e=u.noOp),void 0===t&&(t=u.noOp),r(this,void 0,void 0,(function(){var n,r,s,o,l,p,h;return i(this,(function(i){switch(i.label){case 0:if(!this.isPushSupported())return[2];i.label=1;case 1:return i.trys.push([1,8,,9]),c.default.debug("Registering service worker: ".concat(this._config.serviceWorker)),[4,navigator.serviceWorker.register(this._config.serviceWorker)];case 2:return n=i.sent(),c.default.debug("Installing and registering...",n),[4,navigator.serviceWorker.ready];case 3:return[4,(r=i.sent()).pushManager.getSubscription()];case 4:return s=i.sent(),(0,u.isNil)(s)?(c.default.debug("Attempting to subscribe to push"),o=(0,a.base64UrlToUint8Array)(this.WebPushApiKey),l={applicationServerKey:o,userVisibleOnly:this._config.userVisibleOnly},[4,r.pushManager.subscribe(l)]):[3,6];case 5:return p=i.sent(),this.sendPushRegistrationProperties(p),c.default.debug("Subscribed Successfully"),[3,7];case 6:c.default.debug("Already subscribed to push"),this.sendPushRegistrationProperties(s),i.label=7;case 7:return this.syncServiceWorkerThread(),this.registerPushListeners(),e(),[3,9];case 8:return h=i.sent(),c.default.error("Error during registration and subscription",h),t(h),[3,9];case 9:return[2]}}))}))},e.prototype.unregisterPush=function(e,t){return void 0===e&&(e=u.noOp),void 0===t&&(t=u.noOp),r(this,void 0,void 0,(function(){var n,r,s;return i(this,(function(i){switch(i.label){case 0:if(!this.isPushSupported())return[2];this.check(),i.label=1;case 1:return i.trys.push([1,6,,7]),[4,navigator.serviceWorker.getRegistration(this._config.serviceWorker)];case 2:return[4,(n=i.sent()).pushManager.getSubscription()];case 3:if(r=i.sent(),(0,u.isNil)(r))throw new Error("Could not unregister push. No subscription found");return[4,r.unsubscribe()];case 4:return i.sent(),[4,n.unregister()];case 5:return i.sent(),this.shutdown(),e(),[3,7];case 6:return s=i.sent(),c.default.warn("Could not unregister push. ".concat(s)),t(s),[3,7];case 7:return[2]}}))}))},e.prototype.syncServiceWorkerThread=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),c.default.debug("Syncing with service worker."),[4,this.setPushSession()];case 1:return e=r.sent(),c.default.debug("Push session started for user ".concat(e)),clearInterval(this._pushEventLoopTimer),c.default.debug("Setting background thread for push events flusher."),this._pushEventLoopTimer=setInterval((function(){n.flushPushEventQueue()}),this._eventFlushFreqency),[3,3];case 2:return t=r.sent(),c.default.error("Error setting push session:",t),[3,3];case 3:return[2]}}))}))},e.prototype.isPushSupported=function(){return"serviceWorker"in navigator&&"PushManager"in window},e.prototype.shutdown=function(){this._pushEventLoopTimer&&clearInterval(this._pushEventLoopTimer)},e.prototype.registerPushListeners=function(){var e=this;navigator.serviceWorker.removeEventListener("message",this.pushHandler),navigator.serviceWorker.addEventListener("message",function(t){e.pushHandler(t)}.bind(this),!1)},e.prototype.pushHandler=function(e){c.default.debug("PushManager received message event"),c.default.debug(e);var n=e.data;if((0,u.isNil)(n))c.default.error("Could not parse message from service worker");else switch(n.type){case t.serviceWorkerEventTypes.swrvePushReceived:this.callBackPushReceived(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClicked:this.callBackPushClicked(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClosed:this.callBackPushClosed(e)}},e.prototype.check=function(){if(!this.IsInitialized)throw new Error("SwrvePushManager Not Initialized!")},e.prototype.validatePushSubscription=function(e){return e?e.endpoint?e.getKey("auth")?!!e.getKey("p256dh")||(c.default.error("Invalid pushSubscription: p256dh key are missing"),!1):(c.default.error("Invalid pushSubscription: auth key is missing"),!1):(c.default.error("Invalid pushSubscription: endpoint is missing"),!1):(c.default.error("Invalid pushSubscription: pushSubscription is null or undefined"),!1)},e.prototype.sendPushRegistrationProperties=function(e){if(this.validatePushSubscription(e)){var t=e.toJSON(),n=t.keys.auth,r=t.keys.p256dh,i=t.endpoint;this._webPushToken="".concat(i,"|").concat(r,"|").concat(n),c.default.debug("sending push registration properties : ".concat(this._webPushToken)),c.default.debug("sending push subscription",t),o.SwrveSDK.checkCoreInstance().deviceUpdate({"swrve.web_push_token":this._webPushToken}),this.sendBrowserPermissions()}},e.prototype.sendBrowserPermissions=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.browserHasPermissionsAccess()?[4,navigator.permissions.query({name:"notifications"}).then((function(t){c.default.debug("notifications permission status is  ".concat(t.state)),e.sendPermissionsUpdate(t.state),t.onchange=function(){c.default.debug("notifications permission status has changed to ".concat(this.state)),e.sendPermissionsUpdate(this.state)}}))]:[3,2];case 1:return t.sent(),[3,3];case 2:c.default.warn("notifications permission status is unknown"),e.sendPermissionsUpdate("unknown"),t.label=3;case 3:return[2]}}))}))},e.prototype.flushPushEventQueue=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.fetchPushEvents()];case 1:return(e=n.sent()).length>0&&(c.default.debug("Flushing push events: ".concat(e)),o.SwrveSDK.checkCoreInstance().enqueuePushEvents(e)),[3,3];case 2:return t=n.sent(),c.default.error("Error fetching or processing push events:",t),[3,3];case 3:return[2]}}))}))},e.prototype.fetchPushEvents=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,s;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.isPushSupported())throw new Error("Failed to fetch push data, push is not supported!");return this.check(),[4,navigator.serviceWorker.ready];case 1:return e=i.sent(),(r=new MessageChannel).port1.onmessage=function(e){e.data&&"pushData"===e.data.type&&t(e.data.data)},e.active.postMessage({type:"fetchPushData",user_id:this._userId,port:r.port2},[r.port2]),[3,3];case 2:return s=i.sent(),n(s),[3,3];case 3:return[2]}}))}))}))},e.prototype.setPushSession=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,s;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.isPushSupported())throw new Error("Failed to fetch push data, push is not supported!");return this.check(),[4,navigator.serviceWorker.ready];case 1:return e=i.sent(),(r=new MessageChannel).port1.onmessage=function(e){e.data&&"userSession"===e.data.type&&t(e.data.data)},e.active.postMessage({type:"setUserSession",user_id:this._userId},[r.port2]),[3,3];case 2:return s=i.sent(),n(s),[3,3];case 3:return[2]}}))}))}))},e.prototype.browserHasPermissionsAccess=function(){return void 0!==navigator.permissions},e.sendPermissionsUpdate=function(e){o.SwrveSDK.checkCoreInstance().deviceUpdate({"swrve.permission.web.push_notifications":e})},e}();t.default=l},729:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64UrlToUint8Array=void 0,t.base64UrlToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),i=0;i<n.length;i+=1)r[i]=n.charCodeAt(i);return r}},555:(e,t)=>{"use strict";function n(e){return null==e}Object.defineProperty(t,"__esModule",{value:!0}),t.noOp=t.isPresent=t.isNil=void 0,t.isNil=n,t.isPresent=function(e){return!n(e)},t.noOp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Function()}},913:function(e,t){"use strict";var n=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.error=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.ERROR&&console.error.apply(console,n([t],r,!1))},e.warn=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.WARN&&console.warn.apply(console,n([t],r,!1))},e.info=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.INFO&&console.log.apply(console,n([t],r,!1))},e.debug=function(t){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];i<=e.DEBUG&&console.log.apply(console,n(["DEBUG:",t],r,!1))},e.level=function(e){return void 0===e?i:i=e},e.DEBUG=20,e.INFO=30,e.WARN=40,e.ERROR=50,e.NONE=100,e}();t.default=r;var i=r.DEBUG},147:e=>{"use strict";e.exports=JSON.parse('{"name":"@swrve/web-sdk","version":"2.3.0","author":"Swrve Inc.","license":"Apache-2.0","keywords":["swrve","sdk","web","browser","js","chrome","firefox","safari","engagement","marketing","platform"],"homepage":"https://github.com/Swrve/swrve-web-sdk#readme","bugs":{"url":"https://github.com/Swrve/swrve-web-sdk/issues"},"repository":{"type":"git","url":"git@github.com:Swrve/swrve-web-sdk.git"},"types":"dist/types/src/index.d.ts","files":["dist/SwrveSDK.js","dist/types","dist/SwrveWorker.js"],"main":"dist/SwrveSDK.js","scripts":{"bundle":"yarn run bundle:prod","bundle:dev":"tsc -p tsconfig-build.json --declaration --declarationDir dist/types && webpack --config webpack.dev.js --progress","bundle:prod":"tsc -p tsconfig-build.json --declaration --declarationDir dist/types && webpack --config webpack.prod.js --progress","bundle:release":"yarn run bundle:prod","stats":"webpack --config webpack.prod.js --profile --json > stats.json && webpack-bundle-analyzer stats.json --mode static --no-open","clean":"yarn cache clean && rm -rf ./dist","lint":"tslint --project tsconfig.json","prepublish":"yarn bundle:release","test":"jest --ci --coverage --testResultsProcessor=\'jest-junit\'","test:watch":"jest --watch"},"devDependencies":{"@types/jest":"^27.0.3","clean-webpack-plugin":"1.0.0","jest":"^27.3.1","jest-junit":"^13.0.0","strip-loader":"^0.1.2","ts-jest":"^27.0.7","ts-loader":"^9.2.6","tslint":"5.12.1","typescript":"^4.4.4","webpack":"5.76.0","webpack-bundle-analyzer":"^4.10.1","webpack-cli":"4.10.0","webpack-merge":"4.2.1"},"dependencies":{"@swrve/web-core":"link:../../../web-core-sdk/public/SwrveCoreSDK"}}')}},t={},function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}(16);var e,t}));